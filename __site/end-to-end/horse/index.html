<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
   <!-- Syntax highlighting via Prism, note: restricted langs -->
<link rel="stylesheet" href="/libs/highlight/github.min.css">
 
  <link rel="stylesheet" href="/css/landing.css">
  <link rel="stylesheet" href="/css/franklin.css">
  <link rel="stylesheet" href="/css/pure.css">
  <link rel="stylesheet" href="/css/side-menu.css">
  <link rel="stylesheet" href="/css/nav.css">
  <link rel="stylesheet" href="/css/extra.css">
  <!-- <link rel="icon" href="/assets/infra/favicon.gif"> -->
   <title>Horse colic data</title> 
  <!-- LUNR -->
  <script src="/libs/lunr/lunr.min.js"></script>
  <script src="/libs/lunr/lunr_index.js"></script>
  <script src="/libs/lunr/lunrclient.min.js"></script>
</head>

<body>
  <div id="layout">
    <!-- Menu toggle / hamburger icon -->
    <a href="#menu" id="menuLink" class="menu-link"><span></span></a>
    <div id="menu" style="display: none;">
      <div class="pure-menu">
        <a href="/" id="menu-logo-link">
          <div class="menu-logo">
            <!-- <img id="menu-logo" alt="MLJ Logo" src="/assets/infra/MLJLogo2.svg" /> -->
            <p><strong>Data Science Tutorials</strong></p>
          </div>
        </a>
        <form id="lunrSearchForm" name="lunrSearchForm">
          <input class="search-input" name="q" placeholder="Search in tutorials..." type="text">
          <input type="submit" value="Search" formaction="/search/index.html" style="display:none">
        </form>
        <!-- LIST OF MENU ITEMS -->
        <ul class="pure-menu-list">
          <li class="pure-menu-item pure-menu-top-item "><a
   	      href="https://github.com/JuliaAI/DataScienceTutorials.jl"
              class="pure-menu-link"><strong>Contribute</strong></a></li>

          <!-- DATA BASICS -->
          <div class="dropdown">
            <li class="pure-menu-sublist-title"><strong>Data Basics</strong></li>
          </div>
          <div class="collapse dropdown-content">
            <ul class="pure-menu-sublist">
              <li class="pure-menu-item "><a
                  href="/data/loading/" class="pure-menu-link"><span style="padding-right:0.5rem;">•</span> Loading
                  data</a></li>
              <li class="pure-menu-item "><a
                  href="/data/dataframe/" class="pure-menu-link"><span style="padding-right:0.5rem;">•</span> Data
                  Frames</a></li>
              <li class="pure-menu-item "><a
                  href="/data/categorical/" class="pure-menu-link"><span style="padding-right:0.5rem;">•</span>
                  Categorical Arrays</a></li>
              <li class="pure-menu-item "><a
                  href="/data/scitype/" class="pure-menu-link"><span style="padding-right:0.5rem;">•</span> Scientific
                  Type</a></li>
              <li class="pure-menu-item "><a
                  href="/data/processing/" class="pure-menu-link"><span style="padding-right:0.5rem;">•</span> Data
                  processing</a></li>
            </ul>
          </div>

          <!-- GETTING STARTED WITH MLJ -->
          <div class="dropdown">
            <li class="pure-menu-sublist-title"><strong>Getting Started</strong></li>
          </div>
          <div class="collapse dropdown-content">
            <ul class="pure-menu-sublist">
              <li
                class="pure-menu-item ">
                <a href="/getting-started/choosing-a-model/" class="pure-menu-link"><span
                    style="padding-right:0.5rem;">•</span> Choosing a model</a>
              </li>
              <li class="pure-menu-item ">
                <a href="/getting-started/fit-and-predict/" class="pure-menu-link"><span
                    style="padding-right:0.5rem;">•</span> Fit, predict, transform</a>
              </li>
              <li class="pure-menu-item "><a
                  href="/getting-started/model-tuning/" class="pure-menu-link"><span
                    style="padding-right:0.5rem;">•</span> Model tuning</a></li>
              <li class="pure-menu-item "><a
                  href="/getting-started/ensembles/" class="pure-menu-link"><span style="padding-right:0.5rem;">•</span>
                  Ensembles</a></li>
              <li class="pure-menu-item "><a
                  href="/getting-started/ensembles-2/" class="pure-menu-link"><span
                    style="padding-right:0.5rem;">•</span> Ensembles 2</a></li>
              <li
                class="pure-menu-item ">
                <a href="/getting-started/composing-models/" class="pure-menu-link"><span
                    style="padding-right:0.5rem;">•</span> Composing models</a>
              </li>
              <li class="pure-menu-item "><a
                  href="/getting-started/stacking/" class="pure-menu-link"><span style="padding-right:0.5rem;">•</span>
                  Stacking</a></li>
            </ul>
          </div>
          <!-- INTRO TO STATS LEARNING -->
          <div class="dropdown">
            <li class="pure-menu-sublist-title"><strong>Intro to Stats Learning</strong></li>
          </div>
          <div class="collapse dropdown-content">
            <ul class="pure-menu-sublist" id=isl>
              <li class="pure-menu-item "><a href="/isl/lab-2/"
                  class="pure-menu-link"><span style="padding-right:0.5rem;">•</span> Lab 2</a></li>
              <li class="pure-menu-item "><a href="/isl/lab-3/" class="pure-menu-link"><span
                    style="padding-right:0.5rem;">•</span> Lab 3</a></li>
              <li class="pure-menu-item "><a href="/isl/lab-4/" class="pure-menu-link"><span
                    style="padding-right:0.5rem;">•</span> Lab 4</a></li>
              <li class="pure-menu-item "><a href="/isl/lab-5/" class="pure-menu-link"><span
                    style="padding-right:0.5rem;">•</span> Lab 5</a></li>
              <li class="pure-menu-item "><a href="/isl/lab-6b/" class="pure-menu-link"><span
                    style="padding-right:0.5rem;">•</span> Lab 6b</a></li>
              <li class="pure-menu-item "><a href="/isl/lab-8/" class="pure-menu-link"><span
                    style="padding-right:0.5rem;">•</span> Lab 8</a></li>
              <li class="pure-menu-item "><a href="/isl/lab-9/" class="pure-menu-link"><span
                    style="padding-right:0.5rem;">•</span> Lab 9</a></li>
              <li class="pure-menu-item "><a href="/isl/lab-10/" class="pure-menu-link"><span
                    style="padding-right:0.5rem;">•</span> Lab 10</a></li>
            </ul>
          </div>
          <!-- End to End -->
          <div class="dropdown">
            <li class="pure-menu-sublist-title"><strong>End to End</strong></li>
          </div>
          <div class="dropdown-content collapse">
            <ul class="pure-menu-sublist" >
              <li class="pure-menu-item "><a
                  href="/end-to-end/telco/" class="pure-menu-link"><span style="padding-right:0.5rem;">•</span>Telco
                  Churn</a></li>
              <li class="pure-menu-item "><a
                  href="/end-to-end/AMES/" class="pure-menu-link"><span style="padding-right:0.5rem;">•</span> AMES</a>
              </li>
              <li class="pure-menu-item "><a href="/end-to-end/wine/" class="pure-menu-link"><span
                    style="padding-right:0.5rem;">•</span> Wine</a></li>
              <li class="pure-menu-item "><a
                  href="/end-to-end/crabs-xgb/" class="pure-menu-link"><span style="padding-right:0.5rem;">•</span>
                  Crabs (XGB)</a></li>
              <li class="pure-menu-item "><a href="/end-to-end/horse/" class="pure-menu-link"><span
                    style="padding-right:0.5rem;">•</span> Horse</a></li>
              <li class="pure-menu-item "><a href="/end-to-end/HouseKingCounty/" class="pure-menu-link"><span
                    style="padding-right:0.5rem;">•</span> King County Houses</a></li>
              <li class="pure-menu-item "><a href="/end-to-end/airfoil" class="pure-menu-link"><span
                    style="padding-right:0.5rem;">•</span> Airfoil </a></li>
              <li class="pure-menu-item "><a href="/end-to-end/boston-lgbm" class="pure-menu-link"><span
                    style="padding-right:0.5rem;">•</span> Boston (lgbm) </a></li>
              <li class="pure-menu-item "><a href="/end-to-end/glm/" class="pure-menu-link"><span
                    style="padding-right:0.5rem;">•</span> Using GLM.jl </a></li>
              <li class="pure-menu-item "><a href="/end-to-end/powergen/" class="pure-menu-link"><span
                    style="padding-right:0.5rem;">•</span> Power Generation </a></li>
              <li class="pure-menu-item "><a href="/end-to-end/boston-flux" class="pure-menu-link"><span
                    style="padding-right:0.5rem;">•</span> Boston (Flux) </a></li>
              <li class="pure-menu-item "><a href="/end-to-end/breastcancer" class="pure-menu-link"><span
                    style="padding-right:0.5rem;">•</span> Breast Cancer</a></li>
              <li class="pure-menu-item "><a href="/end-to-end/creditfraud" class="pure-menu-link"><span
                    style="padding-right:0.5rem;">•</span> Credit Fraud</a></li>
            </ul>
          </div>
          <!-- ADVANCED EXAMPLES -->
          <div class="dropdown">
            <li class="pure-menu-sublist-title"><strong>Advanced Examples</strong></li>
          </div>
          <div class="dropdown-content collapse">
            <ul class="pure-menu-sublist" id=adv>
              <li class="pure-menu-item "><a href="/advanced/ensembles-3/" class="pure-menu-link"><span
                    style="padding-right:0.5rem;">•</span> Ensembles (3)</a></li>
            </ul>
          </div>
      </div>
      </ul>
      <!-- END OF LIST OF MENU ITEMS -->
    </div>
  </div>
  <div id="nav" class="navigation">
    <div class="nav-container">
      <div class="brand">
        <a href="/">DataScienceTutorials.jl</a>
      </div>
      <nav>
        <div class="nav-mobile"><a id="nav-toggle" href="#!"><span></span></a></div>
        <ul class="nav-list">
        <!-- horizontal navigation bar gets injected -->
        </ul>
      </nav>
    </div>
  </div>
  <div id="main"> <!-- Closed in foot -->
    

    <!-- Content appended here -->
<div class="franklin-content"><h1 id="horse_colic_data"><a href="#horse_colic_data" class="header-anchor">Horse colic data</a></h1>
<em>To ensure code in this tutorial runs as shown, download the tutorial <a href="https://raw.githubusercontent.com/juliaai/DataScienceTutorials.jl/gh-pages/__generated/end-to-end/horse.tar.gz">project folder</a> and follow <a href="/#learning_by_doing">these instructions</a>.</em></p>
<p><em>If you have questions or suggestions about this tutorial, please open an issue <a href="https://github.com/JuliaAI/DataScienceTutorials.jl/issues/new">here</a>.</em></p>
<p><div class="franklin-toc"><ol><li><a href="#initial_data_processing">Initial data processing</a><ol><li><a href="#getting_the_data">Getting the data</a></li><li><a href="#inspecting_columns">Inspecting columns</a></li><li><a href="#dealing_with_missing_values">Dealing with missing values</a></li></ol></li><li><a href="#a_baseline_model">A baseline model</a></li><li><a href="#trying_another_model">Trying another model</a></li></ol></div>
<div class="dropdown"><h2 id="initial_data_processing"><a href="#initial_data_processing" class="header-anchor">Initial data processing</a></h2></div>
<div class="dropdown-content"><p>In this example, we consider the <a href="http://archive.ics.uci.edu/ml/datasets/Horse&#43;Colic">UCI &quot;horse colic&quot; dataset</a></p>
<p>This is a reasonably messy classification problem with missing values etc and so some work should be expected in the feature processing.</p>
<div class="dropdown"><h3 id="getting_the_data"><a href="#getting_the_data" class="header-anchor">Getting the data</a></h3></div>
<div class="dropdown-content"><p>The data is pre-split in training and testing and we will keep it as such</p>
<pre><code class="language-julia">using MLJ
using HTTP
using CSV
import DataFrames: DataFrame, select&#33;, Not
req1 &#61; HTTP.get&#40;&quot;http://archive.ics.uci.edu/ml/machine-learning-databases/horse-colic/horse-colic.data&quot;&#41;
req2 &#61; HTTP.get&#40;&quot;http://archive.ics.uci.edu/ml/machine-learning-databases/horse-colic/horse-colic.test&quot;&#41;
header &#61; &#91;&quot;surgery&quot;, &quot;age&quot;, &quot;hospital_number&quot;,
    &quot;rectal_temperature&quot;, &quot;pulse&quot;,
    &quot;respiratory_rate&quot;, &quot;temperature_extremities&quot;,
    &quot;peripheral_pulse&quot;, &quot;mucous_membranes&quot;,
    &quot;capillary_refill_time&quot;, &quot;pain&quot;,
    &quot;peristalsis&quot;, &quot;abdominal_distension&quot;,
    &quot;nasogastric_tube&quot;, &quot;nasogastric_reflux&quot;,
    &quot;nasogastric_reflux_ph&quot;, &quot;feces&quot;, &quot;abdomen&quot;,
    &quot;packed_cell_volume&quot;, &quot;total_protein&quot;,
    &quot;abdomcentesis_appearance&quot;, &quot;abdomcentesis_total_protein&quot;,
    &quot;outcome&quot;, &quot;surgical_lesion&quot;, &quot;lesion_1&quot;, &quot;lesion_2&quot;, &quot;lesion_3&quot;,
    &quot;cp_data&quot;&#93;
csv_opts &#61; &#40;header&#61;header, delim&#61;&#39; &#39;, missingstring&#61;&quot;?&quot;,
            ignorerepeated&#61;true&#41;
data_train &#61; CSV.read&#40;req1.body, DataFrame; csv_opts...&#41;
data_test  &#61; CSV.read&#40;req2.body, DataFrame; csv_opts...&#41;
@show size&#40;data_train&#41;
@show size&#40;data_test&#41;</code></pre><pre><code class="plaintext code-output">size(data_train) = (300, 28)
size(data_test) = (68, 28)
</code></pre>
<p>‎</p></div>
<div class="dropdown"><h3 id="inspecting_columns"><a href="#inspecting_columns" class="header-anchor">Inspecting columns</a></h3></div>
<div class="dropdown-content"><p>To simplify the analysis, we will drop the columns <code>Lesion *</code> as they would need specific re-encoding which would distract us a bit.</p>
<pre><code class="language-julia">unwanted &#61; &#91;:lesion_1, :lesion_2, :lesion_3&#93;
data &#61; vcat&#40;data_train, data_test&#41;
select&#33;&#40;data, Not&#40;unwanted&#41;&#41;;</code></pre>
<p>Let&#39;s also keep track of the initial train-test split</p>
<pre><code class="language-julia">train &#61; 1:nrows&#40;data_train&#41;
test &#61; last&#40;train&#41; .&#43; &#40;1:nrows&#40;data_test&#41;&#41;;</code></pre>
<p>We know from reading the description that some of these features represent multiclass data; to facilitate the interpretation, we can use <code>autotype</code> from <code>ScientificTypes</code>. By default, <code>autotype</code> will check all columns and suggest a Finite type assuming there are relatively few distinct values in the column.  More sophisticated rules can be passed, see <a href="https://alan-turing-institute.github.io/ScientificTypes.jl/dev/">ScientificTypes.jl</a>:</p>
<pre><code class="language-julia">coerce&#33;&#40;data, autotype&#40;data&#41;&#41;;</code></pre>
<p>Let&#39;s see column by column whether it looks ok now</p>
<pre><code class="language-julia">schema&#40;data&#41;</code></pre><pre><code class="plaintext code-output">┌─────────────────────────────┬───────────────────────────────────┬───────────────────────────────────────────────────┐
│ names                       │ scitypes                          │ types                                             │
├─────────────────────────────┼───────────────────────────────────┼───────────────────────────────────────────────────┤
│ surgery                     │ Union{Missing, OrderedFactor{2}}  │ Union{Missing, CategoricalValue{Int64, UInt32}}   │
│ age                         │ OrderedFactor{2}                  │ CategoricalValue{Int64, UInt32}                   │
│ hospital_number             │ Count                             │ Int64                                             │
│ rectal_temperature          │ Union{Missing, Continuous}        │ Union{Missing, Float64}                           │
│ pulse                       │ Union{Missing, Count}             │ Union{Missing, Int64}                             │
│ respiratory_rate            │ Union{Missing, Count}             │ Union{Missing, Int64}                             │
│ temperature_extremities     │ Union{Missing, OrderedFactor{4}}  │ Union{Missing, CategoricalValue{Int64, UInt32}}   │
│ peripheral_pulse            │ Union{Missing, OrderedFactor{4}}  │ Union{Missing, CategoricalValue{Int64, UInt32}}   │
│ mucous_membranes            │ Union{Missing, OrderedFactor{6}}  │ Union{Missing, CategoricalValue{Int64, UInt32}}   │
│ capillary_refill_time       │ Union{Missing, OrderedFactor{3}}  │ Union{Missing, CategoricalValue{Int64, UInt32}}   │
│ pain                        │ Union{Missing, OrderedFactor{5}}  │ Union{Missing, CategoricalValue{Int64, UInt32}}   │
│ peristalsis                 │ Union{Missing, OrderedFactor{4}}  │ Union{Missing, CategoricalValue{Int64, UInt32}}   │
│ abdominal_distension        │ Union{Missing, OrderedFactor{4}}  │ Union{Missing, CategoricalValue{Int64, UInt32}}   │
│ nasogastric_tube            │ Union{Missing, OrderedFactor{3}}  │ Union{Missing, CategoricalValue{Int64, UInt32}}   │
│ nasogastric_reflux          │ Union{Missing, OrderedFactor{3}}  │ Union{Missing, CategoricalValue{Int64, UInt32}}   │
│ nasogastric_reflux_ph       │ Union{Missing, OrderedFactor{24}} │ Union{Missing, CategoricalValue{Float64, UInt32}} │
│ feces                       │ Union{Missing, OrderedFactor{4}}  │ Union{Missing, CategoricalValue{Int64, UInt32}}   │
│ abdomen                     │ Union{Missing, OrderedFactor{5}}  │ Union{Missing, CategoricalValue{Int64, UInt32}}   │
│ packed_cell_volume          │ Union{Missing, Continuous}        │ Union{Missing, Float64}                           │
│ total_protein               │ Union{Missing, Continuous}        │ Union{Missing, Float64}                           │
│ abdomcentesis_appearance    │ Union{Missing, OrderedFactor{3}}  │ Union{Missing, CategoricalValue{Int64, UInt32}}   │
│ abdomcentesis_total_protein │ Union{Missing, Continuous}        │ Union{Missing, Float64}                           │
│ outcome                     │ Union{Missing, OrderedFactor{3}}  │ Union{Missing, CategoricalValue{Int64, UInt32}}   │
│ surgical_lesion             │ OrderedFactor{2}                  │ CategoricalValue{Int64, UInt32}                   │
│ cp_data                     │ OrderedFactor{2}                  │ CategoricalValue{Int64, UInt32}                   │
└─────────────────────────────┴───────────────────────────────────┴───────────────────────────────────────────────────┘
</code></pre>
<p>Most columns are now treated as either Multiclass or Ordered, this corresponds to the <a href="https://archive.ics.uci.edu/ml/datasets/Horse&#43;Colic">description of the data</a>. For instance:</p>
<ul>
<li><p><code>Surgery</code> is described as <code>1&#61;yes / 2&#61;no</code></p>
</li>
<li><p><code>Age</code> is described as <code>1&#61;adult / 2&#61;young</code></p>
</li>
</ul>
<p>Inspecting the rest of the descriptions and the current scientific type, there are a few more things that can be observed:</p>
<ul>
<li><p>hospital number is still a count, this means that there are relatively many hospitals and so  that&#39;s  probably not very useful,</p>
</li>
<li><p>pulse and respiratory rate are still as count but the data description suggests that they can be considered as continuous</p>
</li>
</ul>
<pre><code class="language-julia">length&#40;unique&#40;data.hospital_number&#41;&#41;</code></pre><pre><code class="plaintext code-output">346</code></pre>
<p>yeah let&#39;s drop that</p>
<pre><code class="language-julia">data &#61; select&#33;&#40;data, Not&#40;:hospital_number&#41;&#41;;</code></pre>
<p>let&#39;s also coerce the pulse and respiratory rate, by coercing all remaining <code>Count</code> features to <code>Continuous</code>:</p>
<pre><code class="language-julia">coerce&#33;&#40;data, Count &#61;&gt; Continuous&#41;
schema&#40;data&#41;</code></pre><pre><code class="plaintext code-output">┌─────────────────────────────┬───────────────────────────────────┬───────────────────────────────────────────────────┐
│ names                       │ scitypes                          │ types                                             │
├─────────────────────────────┼───────────────────────────────────┼───────────────────────────────────────────────────┤
│ surgery                     │ Union{Missing, OrderedFactor{2}}  │ Union{Missing, CategoricalValue{Int64, UInt32}}   │
│ age                         │ OrderedFactor{2}                  │ CategoricalValue{Int64, UInt32}                   │
│ rectal_temperature          │ Union{Missing, Continuous}        │ Union{Missing, Float64}                           │
│ pulse                       │ Union{Missing, Continuous}        │ Union{Missing, Float64}                           │
│ respiratory_rate            │ Union{Missing, Continuous}        │ Union{Missing, Float64}                           │
│ temperature_extremities     │ Union{Missing, OrderedFactor{4}}  │ Union{Missing, CategoricalValue{Int64, UInt32}}   │
│ peripheral_pulse            │ Union{Missing, OrderedFactor{4}}  │ Union{Missing, CategoricalValue{Int64, UInt32}}   │
│ mucous_membranes            │ Union{Missing, OrderedFactor{6}}  │ Union{Missing, CategoricalValue{Int64, UInt32}}   │
│ capillary_refill_time       │ Union{Missing, OrderedFactor{3}}  │ Union{Missing, CategoricalValue{Int64, UInt32}}   │
│ pain                        │ Union{Missing, OrderedFactor{5}}  │ Union{Missing, CategoricalValue{Int64, UInt32}}   │
│ peristalsis                 │ Union{Missing, OrderedFactor{4}}  │ Union{Missing, CategoricalValue{Int64, UInt32}}   │
│ abdominal_distension        │ Union{Missing, OrderedFactor{4}}  │ Union{Missing, CategoricalValue{Int64, UInt32}}   │
│ nasogastric_tube            │ Union{Missing, OrderedFactor{3}}  │ Union{Missing, CategoricalValue{Int64, UInt32}}   │
│ nasogastric_reflux          │ Union{Missing, OrderedFactor{3}}  │ Union{Missing, CategoricalValue{Int64, UInt32}}   │
│ nasogastric_reflux_ph       │ Union{Missing, OrderedFactor{24}} │ Union{Missing, CategoricalValue{Float64, UInt32}} │
│ feces                       │ Union{Missing, OrderedFactor{4}}  │ Union{Missing, CategoricalValue{Int64, UInt32}}   │
│ abdomen                     │ Union{Missing, OrderedFactor{5}}  │ Union{Missing, CategoricalValue{Int64, UInt32}}   │
│ packed_cell_volume          │ Union{Missing, Continuous}        │ Union{Missing, Float64}                           │
│ total_protein               │ Union{Missing, Continuous}        │ Union{Missing, Float64}                           │
│ abdomcentesis_appearance    │ Union{Missing, OrderedFactor{3}}  │ Union{Missing, CategoricalValue{Int64, UInt32}}   │
│ abdomcentesis_total_protein │ Union{Missing, Continuous}        │ Union{Missing, Float64}                           │
│ outcome                     │ Union{Missing, OrderedFactor{3}}  │ Union{Missing, CategoricalValue{Int64, UInt32}}   │
│ surgical_lesion             │ OrderedFactor{2}                  │ CategoricalValue{Int64, UInt32}                   │
│ cp_data                     │ OrderedFactor{2}                  │ CategoricalValue{Int64, UInt32}                   │
└─────────────────────────────┴───────────────────────────────────┴───────────────────────────────────────────────────┘
</code></pre>
<p>‎</p></div>
<div class="dropdown"><h3 id="dealing_with_missing_values"><a href="#dealing_with_missing_values" class="header-anchor">Dealing with missing values</a></h3></div>
<div class="dropdown-content"><p>There&#39;s quite a lot of missing values, in this tutorial we&#39;ll be a bit rough in how we deal with them applying the following rules of thumb:</p>
<ul>
<li><p>drop the rows where the outcome is unknown</p>
</li>
<li><p>drop columns with more than 20&#37; missing values</p>
</li>
<li><p>simple imputation of whatever&#39;s left</p>
</li>
</ul>
<pre><code class="language-julia">missing_outcome &#61; ismissing.&#40;data.outcome&#41;
idx_missing_outcome &#61; missing_outcome |&gt; findall</code></pre><pre><code class="plaintext code-output">2-element Vector{Int64}:
 133
 309</code></pre>
<p>Ok there&#39;s only two row which is nice, let&#39;s remove them from the train/test indices:</p>
<pre><code class="language-julia">train &#61; setdiff&#33;&#40;train |&gt; collect, idx_missing_outcome&#41;
test &#61; setdiff&#33;&#40;test |&gt; collect, idx_missing_outcome&#41;
all &#61; vcat&#40;train, test&#41;;</code></pre>
<p>Now let&#39;s look at how many missings there are per features</p>
<pre><code class="language-julia">for name in names&#40;data&#41;
    col &#61; data&#91;all, name&#93;
    ratio_missing &#61; sum&#40;ismissing.&#40;col&#41;&#41; / length&#40;all&#41; * 100
    println&#40;rpad&#40;name, 30&#41;, round&#40;ratio_missing, sigdigits&#61;3&#41;&#41;
end</code></pre><pre><code class="plaintext code-output">surgery                       0.0
age                           0.0
rectal_temperature            18.9
pulse                         7.1
respiratory_rate              19.4
temperature_extremities       17.5
peripheral_pulse              22.7
mucous_membranes              13.1
capillary_refill_time         10.4
pain                          17.2
peristalsis                   13.9
abdominal_distension          17.5
nasogastric_tube              35.5
nasogastric_reflux            36.1
nasogastric_reflux_ph         81.1
feces                         34.7
abdomen                       39.1
packed_cell_volume            9.84
total_protein                 11.5
abdomcentesis_appearance      52.7
abdomcentesis_total_protein   63.9
outcome                       0.0
surgical_lesion               0.0
cp_data                       0.0
</code></pre>
<p>Let&#39;s drop the ones with more than 20&#37; &#40;quite a few&#33;&#41;</p>
<pre><code class="language-julia">unwanted &#61; &#91;:peripheral_pulse, :nasogastric_tube, :nasogastric_reflux,
            :nasogastric_reflux_ph, :feces, :abdomen,
            :abdomcentesis_appearance, :abdomcentesis_total_protein&#93;
select&#33;&#40;data, Not&#40;unwanted&#41;&#41;;</code></pre>
<p>Note that we could have done this better and investigated the nature of the features for which there&#39;s a lot of missing values but don&#39;t forget that our goal is to showcase MLJ&#33;</p>
<p>Let&#39;s conclude by filling all missing values and separating the features from the target:</p>
<pre><code class="language-julia">@load FillImputer
filler &#61; machine&#40;FillImputer&#40;&#41;, data&#91;all, :&#93;&#41; |&gt; fit&#33;
data &#61; MLJ.transform&#40;filler, data&#41;

y, X &#61; unpack&#40;data, &#61;&#61;&#40;:outcome&#41;&#41;; # a vector and a table</code></pre><pre><code class="plaintext code-output">import MLJModels ✔
</code></pre>
<p>‎</p></div>
<p>‎</p></div>
<div class="dropdown"><h2 id="a_baseline_model"><a href="#a_baseline_model" class="header-anchor">A baseline model</a></h2></div>
<div class="dropdown-content"><p>Let&#39;s define a first sensible model and get a baseline, basic steps are:</p>
<ul>
<li><p>one-hot-encode the categoricals</p>
</li>
<li><p>feed all this into a classifier</p>
</li>
</ul>
<pre><code class="language-julia">@load OneHotEncoder
MultinomialClassifier &#61; @load MultinomialClassifier pkg&#61;&quot;MLJLinearModels&quot;</code></pre><pre><code class="plaintext code-output">import MLJModels ✔
import MLJLinearModels ✔
MLJLinearModels.MultinomialClassifier</code></pre>
<p>Let&#39;s have convenient handles over the training data</p>
<pre><code class="language-julia">Xtrain &#61; X&#91;train,:&#93;
ytrain &#61; y&#91;train&#93;;</code></pre>
<p>And let&#39;s define a pipeline corresponding to the operations above</p>
<pre><code class="language-julia">pipe &#61; OneHotEncoder&#40;&#41; |&gt;  MultinomialClassifier&#40;&#41;</code></pre><pre><code class="plaintext code-output">ProbabilisticPipeline(
  one_hot_encoder = OneHotEncoder(
        features = Symbol[], 
        drop_last = false, 
        ordered_factor = true, 
        ignore = false), 
  multinomial_classifier = MultinomialClassifier(
        lambda = 2.220446049250313e-16, 
        gamma = 0.0, 
        penalty = :l2, 
        fit_intercept = true, 
        penalize_intercept = false, 
        scale_penalty_with_samples = true, 
        solver = nothing), 
  cache = true)</code></pre>
<p>Here are log loss and accuracy estimates of model performance, obtained by training on 90&#37; of the <code>train</code> data, and computing the measures on the remaining 10&#37;:</p>
<pre><code class="language-julia">metrics &#61; &#91;log_loss, accuracy&#93;
evaluate&#40;
    pipe, Xtrain, ytrain;
    resampling &#61; Holdout&#40;fraction_train&#61;0.9&#41;,
    measures &#61; metrics,
&#41;</code></pre><pre><code class="plaintext code-output">PerformanceEvaluation object with these fields:
  model, measure, operation, measurement, per_fold,
  per_observation, fitted_params_per_fold,
  report_per_fold, train_test_rows, resampling, repeats
Extract:
┌──────────────────────┬──────────────┬─────────────┬──────────┐
│ measure              │ operation    │ measurement │ per_fold │
├──────────────────────┼──────────────┼─────────────┼──────────┤
│ LogLoss(             │ predict      │ 0.835       │ [0.835]  │
│   tol = 2.22045e-16) │              │             │          │
│ Accuracy()           │ predict_mode │ 0.667       │ [0.667]  │
└──────────────────────┴──────────────┴─────────────┴──────────┘
</code></pre>
<p>If we perform cross-validation instead, we also get a very rough idea of the uncertainties in our estimates &#40;&quot;SE&quot; is &quot;standard error&quot;&#41;:</p>
<pre><code class="language-julia">evaluate&#40;pipe, Xtrain, ytrain; resampling&#61;CV&#40;nfolds&#61;6&#41;, measures&#61;metrics&#41;</code></pre><pre><code class="plaintext code-output">PerformanceEvaluation object with these fields:
  model, measure, operation, measurement, per_fold,
  per_observation, fitted_params_per_fold,
  report_per_fold, train_test_rows, resampling, repeats
Extract:
┌──────────────────────┬──────────────┬─────────────┬─────────┬─────────────────────────────────────────┐
│ measure              │ operation    │ measurement │ 1.96*SE │ per_fold                                │
├──────────────────────┼──────────────┼─────────────┼─────────┼─────────────────────────────────────────┤
│ LogLoss(             │ predict      │ 0.735       │ 0.162   │ [0.978, 0.566, 0.65, 0.525, 0.91, 0.78] │
│   tol = 2.22045e-16) │              │             │         │                                         │
│ Accuracy()           │ predict_mode │ 0.686       │ 0.0418  │ [0.62, 0.74, 0.68, 0.72, 0.64, 0.714]   │
└──────────────────────┴──────────────┴─────────────┴─────────┴─────────────────────────────────────────┘
</code></pre>
<p>And for a final comparison, here&#39;s how we do on the test set, which we have not yet touched:</p>
<pre><code class="language-julia">mach &#61; machine&#40;pipe, Xtrain, ytrain&#41; |&gt; fit&#33;
fit&#33;&#40;mach, verbosity&#61;0&#41;
yhat_prob &#61; predict&#40;mach, X&#91;test,:&#93;&#41;
m &#61; log_loss&#40;yhat_prob, y&#91;test&#93;&#41;
println&#40;&quot;log loss: &quot;, round&#40;m, sigdigits&#61;4&#41;&#41;

yhat &#61; mode.&#40;yhat_prob&#41;
m &#61; accuracy&#40;yhat, y&#91;test&#93;&#41;
println&#40;&quot;accuracy: &quot;, round&#40;m, sigdigits&#61;4&#41;&#41;</code></pre><pre><code class="plaintext code-output">log loss: 0.965
accuracy: 0.7164
</code></pre>
<p>That&#39;s not bad at all actually.</p>
<p>Since our data set is relatively small, we do not expect a statistically significant improvement with hyperparameter tuning. However, for the sake of illustration we&#39;ll attempt this.</p>
<pre><code class="language-julia">lambdas &#61; range&#40;pipe, :&#40;multinomial_classifier.lambda&#41;, lower&#61;1e-3, upper&#61;100, scale&#61;:log10&#41;
tuned_pipe &#61; TunedModel&#40;
    pipe;
    tuning&#61;Grid&#40;resolution&#61;20&#41;,
    range&#61;lambdas, measure&#61;log_loss,
    acceleration&#61;CPUThreads&#40;&#41;,
&#41;
mach &#61; machine&#40;tuned_pipe, Xtrain, ytrain&#41; |&gt; fit&#33;
best_pipe &#61; fitted_params&#40;mach&#41;.best_model</code></pre><pre><code class="plaintext code-output">ProbabilisticPipeline(
  one_hot_encoder = OneHotEncoder(
        features = Symbol[], 
        drop_last = false, 
        ordered_factor = true, 
        ignore = false), 
  multinomial_classifier = MultinomialClassifier(
        lambda = 0.06951927961775606, 
        gamma = 0.0, 
        penalty = :l2, 
        fit_intercept = true, 
        penalize_intercept = false, 
        scale_penalty_with_samples = true, 
        solver = nothing), 
  cache = true)</code></pre>
<pre><code class="language-julia">evaluate&#33;&#40;mach; resampling&#61;CV&#40;nfolds&#61;6&#41;, measures&#61;metrics&#41;</code></pre><pre><code class="plaintext code-output">PerformanceEvaluation object with these fields:
  model, measure, operation, measurement, per_fold,
  per_observation, fitted_params_per_fold,
  report_per_fold, train_test_rows, resampling, repeats
Extract:
┌──────────────────────┬──────────────┬─────────────┬─────────┬───────────────────────────────────────────┐
│ measure              │ operation    │ measurement │ 1.96*SE │ per_fold                                  │
├──────────────────────┼──────────────┼─────────────┼─────────┼───────────────────────────────────────────┤
│ LogLoss(             │ predict      │ 0.706       │ 0.111   │ [0.798, 0.63, 0.638, 0.528, 0.866, 0.774] │
│   tol = 2.22045e-16) │              │             │         │                                           │
│ Accuracy()           │ predict_mode │ 0.686       │ 0.0317  │ [0.68, 0.7, 0.7, 0.74, 0.64, 0.653]       │
└──────────────────────┴──────────────┴─────────────┴─────────┴───────────────────────────────────────────┘
</code></pre>
<p>So, not likely a statistically significant difference. Nevertheless, let&#39;s see how we do with accuracy on a holdout set:</p>
<pre><code class="language-julia">fit&#33;&#40;mach&#41; # fit on all the train data
yhat &#61; predict_mode&#40;mach, X&#91;test,:&#93;&#41;
m &#61; accuracy&#40;yhat, y&#91;test&#93;&#41;
println&#40;&quot;accuracy: &quot;, round&#40;m, sigdigits&#61;4&#41;&#41;</code></pre><pre><code class="plaintext code-output">accuracy: 0.7612
</code></pre>
<p>So an improvement after all on the test set.</p>
<p>We&#39;ve probably reached the limit of a simple linear model.</p>
<p>‎</p></div>
<div class="dropdown"><h2 id="trying_another_model"><a href="#trying_another_model" class="header-anchor">Trying another model</a></h2></div>
<div class="dropdown-content"><p>There are lots of categoricals, so maybe it&#39;s just better to use something that deals well with that like a tree-based classifier.</p>
<pre><code class="language-julia">EvoTreeClassifier &#61; @load EvoTreeClassifier
model &#61; EvoTreeClassifier&#40;&#41;
mach &#61; machine&#40;model, Xtrain, ytrain&#41;
evaluate&#33;&#40;mach; resampling&#61;CV&#40;nfolds&#61;6&#41;, measures&#61;metrics&#41;</code></pre><pre><code class="plaintext code-output">import EvoTrees ✔
PerformanceEvaluation object with these fields:
  model, measure, operation, measurement, per_fold,
  per_observation, fitted_params_per_fold,
  report_per_fold, train_test_rows, resampling, repeats
Extract:
┌──────────────────────┬──────────────┬─────────────┬─────────┬─────────────────────────────────────────┐
│ measure              │ operation    │ measurement │ 1.96*SE │ per_fold                                │
├──────────────────────┼──────────────┼─────────────┼─────────┼─────────────────────────────────────────┤
│ LogLoss(             │ predict      │ 0.848       │ 0.106   │ [0.903, 0.699, 0.917, 0.694, 0.9, 0.98] │
│   tol = 2.22045e-16) │              │             │         │                                         │
│ Accuracy()           │ predict_mode │ 0.719       │ 0.0532  │ [0.78, 0.68, 0.7, 0.8, 0.64, 0.714]     │
└──────────────────────┴──────────────┴─────────────┴─────────┴─────────────────────────────────────────┘
</code></pre>
<p>That&#39;s better accuracy, although not significantly better, than the other CV estimates based on <code>train</code>, and without any tuning. Do we actually do better on the <code>test</code> set?</p>
<pre><code class="language-julia">fit&#33;&#40;mach&#41; # fit on all the train data
yhat &#61; predict_mode&#40;mach, X&#91;test,:&#93;&#41;
m &#61; accuracy&#40;yhat, y&#91;test&#93;&#41;
println&#40;&quot;accuracy: &quot;, round&#40;m, sigdigits&#61;4&#41;&#41;</code></pre><pre><code class="plaintext code-output">accuracy: 0.791
</code></pre>
<p>So, the best so far.</p>
<p>We could investigate more, try tuning etc, but the key points of this tutorial was to show how to handle data with missing values.</p>
<p>‎</p></div>

<div class="bottom-nav-container">
  <a id="prev-tutorial" style="text-decoration: none"><Button class="bottom-nav">
        <div>← Previous Tutorial</div>
        <div id="prev-label" class="button-label"> Home</div>
    </Button></a>
  <a id="next-tutorial" style="text-decoration: none"><Button class="bottom-nav">
        <div>Next Tutorial →</div>
        <div id="next-label" class="button-label">Home</div> 
    </Button></a>
</div>
<div class="page-foot">
  <div class="copyright">
    &copy; Thibaut Lienart, Anthony Blaom, Sebastian Vollmer and collaborators. Last modified: June 16, 2024. Website built with <a
      href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a>.
  </div>
</div></div><!-- CONTENT ENDS HERE -->
</div> <!-- end of id=main -->
</div> <!-- end of id=layout -->
<!-- for collapse functionality -->
<script src="/libs/collapse/collapse.js"></script>
<script src="/libs/pure/ui.min.js"></script>
<!-- head and footer-nav -->
<script src="/libs/nav/head.js"  type="module"></script>
<!-- landing page -->
<script src="/libs/landing/landing.js"></script>
<!-- navigation bar -->
<script src="/libs/nav/nav.js"></script>
<!-- responsive navigation bar -->
<script src="/libs/nav/responsive.js"></script>


<script src="/libs/highlight/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();hljs.configure({tabReplace: '    '});</script>


</body>

</html>