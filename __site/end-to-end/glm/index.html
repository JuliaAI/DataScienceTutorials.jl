<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/DataScienceTutorials.jl/libs/highlight/github.min.css"> <link rel=stylesheet  href="/DataScienceTutorials.jl/css/franklin.css"> <link rel=stylesheet  href="/DataScienceTutorials.jl/css/pure.css"> <link rel=stylesheet  href="/DataScienceTutorials.jl/css/side-menu.css"> <link rel=stylesheet  href="/DataScienceTutorials.jl/css/extra.css"> <title>Using GLM.jl</title> <script src="/DataScienceTutorials.jl/libs/lunr/lunr.min.js"></script> <script src="/DataScienceTutorials.jl/libs/lunr/lunr_index.js"></script> <script src="/DataScienceTutorials.jl/libs/lunr/lunrclient.min.js"></script> <div id=layout > <a href="#menu" id=menuLink  class=menu-link ><span></span></a> <div id=menu > <div class=pure-menu > <a href="/DataScienceTutorials.jl/" id=menu-logo-link > <div class=menu-logo > <p><strong>Data Science Tutorials</strong></p> </div> </a> <form id=lunrSearchForm  name=lunrSearchForm > <input class=search-input  name=q  placeholder="Enter search term" type=text > <input type=submit  value=Search  formaction="/DataScienceTutorials.jl/search/index.html" style="visibility:hidden"> </form> <ul class=pure-menu-list > <li class="pure-menu-item pure-menu-top-item "><a href="/DataScienceTutorials.jl/" class=pure-menu-link ><strong>Home</strong></a> <li class=pure-menu-sublist-title ><strong>Data basics</strong> <ul class=pure-menu-sublist > <li class="pure-menu-item "><a href="/DataScienceTutorials.jl/data/loading/" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Loading data</a> <li class="pure-menu-item "><a href="/DataScienceTutorials.jl/data/dataframe/" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Data Frames</a> <li class="pure-menu-item "><a href="/DataScienceTutorials.jl/data/categorical/" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Categorical Arrays</a> <li class="pure-menu-item "><a href="/DataScienceTutorials.jl/data/scitype/" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Scientific Type</a> <li class="pure-menu-item "><a href="/DataScienceTutorials.jl/data/processing/" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Data processing</a> </ul> <li class=pure-menu-sublist-title ><strong>Getting started</strong> <ul class=pure-menu-sublist > <li class="pure-menu-item "><a href="/DataScienceTutorials.jl/getting-started/choosing-a-model/" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Choosing a model</a> <li class="pure-menu-item "><a href="/DataScienceTutorials.jl/getting-started/fit-and-predict/" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Fit, predict, transform</a> <li class="pure-menu-item "><a href="/DataScienceTutorials.jl/getting-started/model-tuning/" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Model tuning</a> <li class="pure-menu-item "><a href="/DataScienceTutorials.jl/getting-started/ensembles/" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Ensembles</a> <li class="pure-menu-item "><a href="/DataScienceTutorials.jl/getting-started/ensembles-2/" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Ensembles (2)</a> <li class="pure-menu-item "><a href="/DataScienceTutorials.jl/getting-started/ensembles-3/" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Ensembles (3)</a> <li class="pure-menu-item "><a href="/DataScienceTutorials.jl/getting-started/composing-models/" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Composing models</a> <li class="pure-menu-item "><a href="/DataScienceTutorials.jl/getting-started/learning-networks/" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Learning networks</a> <li class="pure-menu-item "><a href="/DataScienceTutorials.jl/getting-started/learning-networks-2/" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Learning networks (2)</a> <li class="pure-menu-item "><a href="/DataScienceTutorials.jl/getting-started/stacking/" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Stacking</a> </ul> <li class=pure-menu-sublist-title ><strong>Intro to Stats Learning</strong> <ul class=pure-menu-sublist  id=isl> <li class="pure-menu-item "><a href="/DataScienceTutorials.jl/isl/lab-2/" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Lab 2</a> <li class="pure-menu-item "><a href="/DataScienceTutorials.jl/isl/lab-3/" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Lab 3</a> <li class="pure-menu-item "><a href="/DataScienceTutorials.jl/isl/lab-4/" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Lab 4</a> <li class="pure-menu-item "><a href="/DataScienceTutorials.jl/isl/lab-5/" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Lab 5</a> <li class="pure-menu-item "><a href="/DataScienceTutorials.jl/isl/lab-6b/" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Lab 6b</a> <li class="pure-menu-item "><a href="/DataScienceTutorials.jl/isl/lab-8/" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Lab 8</a> <li class="pure-menu-item "><a href="/DataScienceTutorials.jl/isl/lab-9/" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Lab 9</a> <li class="pure-menu-item "><a href="/DataScienceTutorials.jl/isl/lab-10/" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Lab 10</a> </ul> <li class=pure-menu-sublist-title ><strong>End to end examples</strong> <ul class=pure-menu-sublist  id=e2e> <li class="pure-menu-item "><a href="/DataScienceTutorials.jl/end-to-end/AMES/" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> AMES</a> <li class="pure-menu-item "><a href="/DataScienceTutorials.jl/end-to-end/wine/" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Wine</a> <li class="pure-menu-item "><a href="/DataScienceTutorials.jl/end-to-end/crabs-xgb/" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Crabs (XGB)</a> <li class="pure-menu-item "><a href="/DataScienceTutorials.jl/end-to-end/horse/" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Horse</a> <li class="pure-menu-item "><a href="/DataScienceTutorials.jl/end-to-end/HouseKingCounty/" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> King County Houses</a> <li class="pure-menu-item "><a href="/DataScienceTutorials.jl/end-to-end/airfoil" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Airfoil </a> <li class="pure-menu-item "><a href="/DataScienceTutorials.jl/end-to-end/boston-lgbm" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Boston (lgbm) </a> <li class="pure-menu-item "><a href="/DataScienceTutorials.jl/end-to-end/glm/" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Using GLM.jl </a> <li class="pure-menu-item "><a href="/DataScienceTutorials.jl/end-to-end/powergen/" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Power Generation </a> <li class="pure-menu-item "><a href="/DataScienceTutorials.jl/end-to-end/boston-flux" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Boston (Flux) </a> </ul> </ul> </div> </div> <div id=main > <div class=franklin-content ><h1 id=using_glmjl ><a href="#using_glmjl">Using GLM.jl</a></h1> <em>Download the</em> <a href="https://raw.githubusercontent.com/alan-turing-institute/DataScienceTutorials.jl/gh-pages/generated/notebooks/EX-GLM.ipynb" target=_blank ><em>notebook</em></a>, <em>the</em> <a href="https://raw.githubusercontent.com/alan-turing-institute/DataScienceTutorials.jl/gh-pages/generated/scripts/EX-GLM-raw.jl" target=_blank ><em>raw script</em></a>, <em>or the</em> <a href="https://raw.githubusercontent.com/alan-turing-institute/DataScienceTutorials.jl/gh-pages/generated/scripts/EX-GLM.jl" target=_blank ><em>annotated script</em></a> <em>for this tutorial &#40;right-click on the link and save&#41;.</em> <div class=franklin-toc ><ol><li><a href="#reading_the_data">Reading the data</a><li><a href="#defining_the_linear_model">Defining the Linear Model</a><li><a href="#reading_the_output_of_fitting_the_linear_model">Reading the Output of Fitting the Linear Model</a><li><a href="#defining_the_logistic_model">Defining the Logistic Model</a><li><a href="#reading_the_output_from_the_prediction_of_the_logistic_model">Reading the Output from the Prediction of the Logistic Model</a></ol></div><strong>Main author</strong>: <a href="https://github.com/drcxcruz">Clarman Cruz</a>.</p> <p>This juypter lab showcases MLJ in particular using the popular <a href="https://github.com/JuliaStats/GLM.jl">GLM</a> Julia package. We are using two datasets. One dataset was created manually for testing purposes. The other data set is the CollegeDistance dataset from the <a href="https://cran.r-project.org/web/packages/AER/index.html">AER</a> package in R.</p> <p>We can quickly define our models in MLJ and study their results. It is very easy and consistent.</p> <pre><code class="julia hljs"><span class=hljs-keyword >using</span> MLJ, CategoricalArrays, PrettyPrinting
<span class=hljs-keyword >import</span> DataFrames: DataFrame, nrow
<span class=hljs-keyword >using</span> UrlDownload
<span class=hljs-meta >@load</span> LinearRegressor pkg = GLM
<span class=hljs-meta >@load</span> LinearBinaryClassifier pkg=GLM</code></pre><pre><code class="plaintext hljs">InterruptException:
</code></pre> <h2 id=reading_the_data ><a href="#reading_the_data">Reading the data</a></h2> <p>The CollegeDistance dataset was stored in a CSV file. Here, we read the input file.</p> <pre><code class="julia hljs">baseurl = <span class=hljs-string >&quot;https://raw.githubusercontent.com/tlienart/DataScienceTutorialsData.jl/master/data/glm/&quot;</span>

dfX = DataFrame(urldownload(baseurl * <span class=hljs-string >&quot;X3.csv&quot;</span>))
dfYbinary = DataFrame(urldownload(baseurl * <span class=hljs-string >&quot;Y3.csv&quot;</span>))
dfX1 = DataFrame(urldownload(baseurl * <span class=hljs-string >&quot;X1.csv&quot;</span>))
dfY1 = DataFrame(urldownload(baseurl * <span class=hljs-string >&quot;Y1.csv&quot;</span>));</code></pre><pre><code class="plaintext hljs">UndefVarError: urldownload not defined
</code></pre> <p>You can have a look at those using <code>first</code>:</p> <pre><code class="julia hljs">first(dfX, <span class=hljs-number >3</span>)</code></pre><pre><code class="plaintext hljs">UndefVarError: dfX not defined
</code></pre> <p>same for Y:</p> <pre><code class="julia hljs">first(dfY1, <span class=hljs-number >3</span>)</code></pre><pre><code class="plaintext hljs">UndefVarError: dfY1 not defined
</code></pre> <h2 id=defining_the_linear_model ><a href="#defining_the_linear_model">Defining the Linear Model</a></h2> <p>Let see how many MLJ models handle our kind of target which is the y variable.</p> <pre><code class="julia hljs">ms = models() <span class=hljs-keyword >do</span> m
    <span class=hljs-built_in >AbstractVector</span>{Count} &lt;: m.target_scitype
<span class=hljs-keyword >end</span>
foreach(m -&gt; println(m.name), ms)</code></pre><pre><code class="plaintext hljs">InterruptException:
</code></pre> <p>How about if the type was Continuous:</p> <pre><code class="julia hljs">ms = models() <span class=hljs-keyword >do</span> m
    <span class=hljs-built_in >Vector</span>{Continuous} &lt;: m.target_scitype
<span class=hljs-keyword >end</span>
foreach(m -&gt; println(m.name), ms)</code></pre><pre><code class="plaintext hljs">InterruptException:
</code></pre> <p>We can quickly define our models in MLJ. It is very easy and consistent.</p> <pre><code class="julia hljs">X = copy(dfX1)
y = copy(dfY1)

coerce!(X, autotype(X, :string_to_multiclass))
yv = <span class=hljs-built_in >Vector</span>(y[:, <span class=hljs-number >1</span>])

LinearRegressorPipe = <span class=hljs-meta >@pipeline</span>(Standardizer(),
                                OneHotEncoder(drop_last = <span class=hljs-literal >true</span>),
                                LinearRegressor())

LinearModel = machine(LinearRegressorPipe, X, yv)
fit!(LinearModel)
fp = fitted_params(LinearModel)</code></pre><pre><code class="plaintext hljs">UndefVarError: dfX1 not defined
</code></pre> <h2 id=reading_the_output_of_fitting_the_linear_model ><a href="#reading_the_output_of_fitting_the_linear_model">Reading the Output of Fitting the Linear Model</a></h2> <p>We can quickly read the results of our models in MLJ. Remember to compute the accuracy of the linear model.</p> <pre><code class="julia hljs">ŷ = MLJ.predict(LinearModel, X)
yhatResponse = [ŷ[i,<span class=hljs-number >1</span>] <span class=hljs-keyword >for</span> i <span class=hljs-keyword >in</span> <span class=hljs-number >1</span>:nrow(y)]
residuals = y .- yhatResponse
r = report(LinearModel)

k = collect(keys(fp.fitted_params_given_machine))[<span class=hljs-number >3</span>]
println(<span class=hljs-string >&quot;\n Coefficients:  &quot;</span>, fp.fitted_params_given_machine[k].coefs)
println(<span class=hljs-string >&quot;\n y \n &quot;</span>, y[<span class=hljs-number >1</span>:<span class=hljs-number >5</span>,<span class=hljs-number >1</span>])
println(<span class=hljs-string >&quot;\n ŷ \n &quot;</span>, ŷ[<span class=hljs-number >1</span>:<span class=hljs-number >5</span>])
println(<span class=hljs-string >&quot;\n yhatResponse \n &quot;</span>, yhatResponse[<span class=hljs-number >1</span>:<span class=hljs-number >5</span>])
println(<span class=hljs-string >&quot;\n Residuals \n &quot;</span>, y[<span class=hljs-number >1</span>:<span class=hljs-number >5</span>,<span class=hljs-number >1</span>] .- yhatResponse[<span class=hljs-number >1</span>:<span class=hljs-number >5</span>])</code></pre><pre><code class="plaintext hljs">UndefVarError: LinearModel not defined
</code></pre> <p>and get the accuracy</p> <pre><code class="julia hljs">round(rms(yhatResponse, y[:,<span class=hljs-number >1</span>]), sigdigits=<span class=hljs-number >4</span>)</code></pre><pre><code class="plaintext hljs">UndefVarError: y not defined
</code></pre> <h2 id=defining_the_logistic_model ><a href="#defining_the_logistic_model">Defining the Logistic Model</a></h2> <pre><code class="julia hljs">X = copy(dfX)
y = copy(dfYbinary)

coerce!(X, autotype(X, :string_to_multiclass))
yc = CategoricalArray(y[:, <span class=hljs-number >1</span>])
yc = coerce(yc, OrderedFactor)

LinearBinaryClassifierPipe = <span class=hljs-meta >@pipeline</span>(Standardizer(),
                                       OneHotEncoder(drop_last = <span class=hljs-literal >true</span>),
                                       LinearBinaryClassifier())

LogisticModel = machine(LinearBinaryClassifierPipe, X, yc)
fit!(LogisticModel)
fp = fitted_params(LogisticModel)</code></pre><pre><code class="plaintext hljs">UndefVarError: dfX not defined
</code></pre> <h2 id=reading_the_output_from_the_prediction_of_the_logistic_model ><a href="#reading_the_output_from_the_prediction_of_the_logistic_model">Reading the Output from the Prediction of the Logistic Model</a></h2> <p>The output of the MLJ model basically contain the same information as the R version of the model.</p> <pre><code class="julia hljs">ŷ = MLJ.predict(LogisticModel, X)
residuals = [<span class=hljs-number >1</span> - pdf(ŷ[i], y[i,<span class=hljs-number >1</span>]) <span class=hljs-keyword >for</span> i <span class=hljs-keyword >in</span> <span class=hljs-number >1</span>:nrow(y)]
r = report(LogisticModel)

k = collect(keys(fp.fitted_params_given_machine))[<span class=hljs-number >3</span>]
println(<span class=hljs-string >&quot;\n Coefficients:  &quot;</span>, fp.fitted_params_given_machine[k].coef)
println(<span class=hljs-string >&quot;\n y \n &quot;</span>, y[<span class=hljs-number >1</span>:<span class=hljs-number >5</span>,<span class=hljs-number >1</span>])
println(<span class=hljs-string >&quot;\n ŷ \n &quot;</span>, ŷ[<span class=hljs-number >1</span>:<span class=hljs-number >5</span>])
println(<span class=hljs-string >&quot;\n residuals \n &quot;</span>, residuals[<span class=hljs-number >1</span>:<span class=hljs-number >5</span>])
println(<span class=hljs-string >&quot;\n Standard Error per Coefficient \n&quot;</span>, r.report_given_machine[k].stderror)</code></pre><pre><code class="plaintext hljs">UndefVarError: LogisticModel not defined
</code></pre> <p>No logistic analysis is complete without the confusion matrix:</p> <pre><code class="julia hljs">yMode = [mode(ŷ[i]) <span class=hljs-keyword >for</span> i <span class=hljs-keyword >in</span> <span class=hljs-number >1</span>:length(ŷ)]
y = coerce(y[:,<span class=hljs-number >1</span>], OrderedFactor)
yMode = coerce(yMode, OrderedFactor)
confusion_matrix(yMode, y)</code></pre><pre><code class="plaintext hljs">UndefVarError: ŷ not defined
</code></pre><div class=page-foot > <div class=copyright > &copy; Thibaut Lienart, Anthony Blaom and collaborators. Last modified: June 22, 2020. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a>. </div> </div> </div> </div> </div> <script src="/DataScienceTutorials.jl/libs/pure/ui.min.js"></script>