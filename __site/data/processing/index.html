<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
   <!-- Syntax highlighting via Prism, note: restricted langs -->
<link rel="stylesheet" href="/DataScienceTutorials.jl/libs/highlight/github.min.css">
 
  <link rel="stylesheet" href="/DataScienceTutorials.jl/css/landing.css">
  <link rel="stylesheet" href="/DataScienceTutorials.jl/css/franklin.css">
  <link rel="stylesheet" href="/DataScienceTutorials.jl/css/pure.css">
  <link rel="stylesheet" href="/DataScienceTutorials.jl/css/side-menu.css">
  <link rel="stylesheet" href="/DataScienceTutorials.jl/css/nav.css">
  <link rel="stylesheet" href="/DataScienceTutorials.jl/css/extra.css">
  <!-- <link rel="icon" href="/DataScienceTutorials.jl/assets/infra/favicon.gif"> -->
   <title>Further data processing</title> 
  <!-- LUNR -->
  <script src="/DataScienceTutorials.jl/libs/lunr/lunr.min.js"></script>
  <script src="/DataScienceTutorials.jl/libs/lunr/lunr_index.js"></script>
  <script src="/DataScienceTutorials.jl/libs/lunr/lunrclient.min.js"></script>
</head>

<body>
  <div id="layout">
    <!-- Menu toggle / hamburger icon -->
    <a href="#menu" id="menuLink" class="menu-link"><span></span></a>
    <div id="menu" style="display: none;">
      <div class="pure-menu">
        <a href="/DataScienceTutorials.jl/" id="menu-logo-link">
          <div class="menu-logo">
            <!-- <img id="menu-logo" alt="MLJ Logo" src="/DataScienceTutorials.jl/assets/infra/MLJLogo2.svg" /> -->
            <p><strong>Data Science Tutorials</strong></p>
          </div>
        </a>
        <form id="lunrSearchForm" name="lunrSearchForm">
          <input class="search-input" name="q" placeholder="Search in tutorials..." type="text">
          <input type="submit" value="Search" formaction="/DataScienceTutorials.jl/search/index.html" style="display:none">
        </form>
        <!-- LIST OF MENU ITEMS -->
        <ul class="pure-menu-list">
          <li class="pure-menu-item pure-menu-top-item "><a href="/DataScienceTutorials.jl/"
              class="pure-menu-link"><strong>Home</strong></a></li>

          <!-- DATA BASICS -->
          <div class="dropdown">
            <li class="pure-menu-sublist-title"><strong>Data Basics</strong></li>
          </div>
          <div class="collapse dropdown-content">
            <ul class="pure-menu-sublist">
              <li class="pure-menu-item "><a
                  href="/DataScienceTutorials.jl/data/loading/" class="pure-menu-link"><span style="padding-right:0.5rem;">•</span> Loading
                  data</a></li>
              <li class="pure-menu-item "><a
                  href="/DataScienceTutorials.jl/data/dataframe/" class="pure-menu-link"><span style="padding-right:0.5rem;">•</span> Data
                  Frames</a></li>
              <li class="pure-menu-item "><a
                  href="/DataScienceTutorials.jl/data/categorical/" class="pure-menu-link"><span style="padding-right:0.5rem;">•</span>
                  Categorical Arrays</a></li>
              <li class="pure-menu-item "><a
                  href="/DataScienceTutorials.jl/data/scitype/" class="pure-menu-link"><span style="padding-right:0.5rem;">•</span> Scientific
                  Type</a></li>
              <li class="pure-menu-item "><a
                  href="/DataScienceTutorials.jl/data/processing/" class="pure-menu-link"><span style="padding-right:0.5rem;">•</span> Data
                  processing</a></li>
            </ul>
          </div>

          <!-- GETTING STARTED WITH MLJ -->
          <div class="dropdown">
            <li class="pure-menu-sublist-title"><strong>Getting Started</strong></li>
          </div>
          <div class="collapse dropdown-content">
            <ul class="pure-menu-sublist">
              <li
                class="pure-menu-item ">
                <a href="/DataScienceTutorials.jl/getting-started/choosing-a-model/" class="pure-menu-link"><span
                    style="padding-right:0.5rem;">•</span> Choosing a model</a>
              </li>
              <li class="pure-menu-item ">
                <a href="/DataScienceTutorials.jl/getting-started/fit-and-predict/" class="pure-menu-link"><span
                    style="padding-right:0.5rem;">•</span> Fit, predict, transform</a>
              </li>
              <li class="pure-menu-item "><a
                  href="/DataScienceTutorials.jl/getting-started/model-tuning/" class="pure-menu-link"><span
                    style="padding-right:0.5rem;">•</span> Model tuning</a></li>
              <li class="pure-menu-item "><a
                  href="/DataScienceTutorials.jl/getting-started/ensembles/" class="pure-menu-link"><span style="padding-right:0.5rem;">•</span>
                  Ensembles</a></li>
              <li class="pure-menu-item "><a
                  href="/DataScienceTutorials.jl/getting-started/ensembles-2/" class="pure-menu-link"><span
                    style="padding-right:0.5rem;">•</span> Ensembles 2</a></li>
              <li
                class="pure-menu-item ">
                <a href="/DataScienceTutorials.jl/getting-started/composing-models/" class="pure-menu-link"><span
                    style="padding-right:0.5rem;">•</span> Composing models</a>
              </li>
              <li class="pure-menu-item "><a
                  href="/DataScienceTutorials.jl/getting-started/stacking/" class="pure-menu-link"><span style="padding-right:0.5rem;">•</span>
                  Stacking</a></li>
            </ul>
          </div>
          <!-- INTRO TO STATS LEARNING -->
          <div class="dropdown">
            <li class="pure-menu-sublist-title"><strong>Intro to Stats Learning</strong></li>
          </div>
          <div class="collapse dropdown-content">
            <ul class="pure-menu-sublist" id=isl>
              <li class="pure-menu-item "><a href="/DataScienceTutorials.jl/isl/lab-2/"
                  class="pure-menu-link"><span style="padding-right:0.5rem;">•</span> Lab 2</a></li>
              <li class="pure-menu-item "><a href="/DataScienceTutorials.jl/isl/lab-3/" class="pure-menu-link"><span
                    style="padding-right:0.5rem;">•</span> Lab 3</a></li>
              <li class="pure-menu-item "><a href="/DataScienceTutorials.jl/isl/lab-4/" class="pure-menu-link"><span
                    style="padding-right:0.5rem;">•</span> Lab 4</a></li>
              <li class="pure-menu-item "><a href="/DataScienceTutorials.jl/isl/lab-5/" class="pure-menu-link"><span
                    style="padding-right:0.5rem;">•</span> Lab 5</a></li>
              <li class="pure-menu-item "><a href="/DataScienceTutorials.jl/isl/lab-6b/" class="pure-menu-link"><span
                    style="padding-right:0.5rem;">•</span> Lab 6b</a></li>
              <li class="pure-menu-item "><a href="/DataScienceTutorials.jl/isl/lab-8/" class="pure-menu-link"><span
                    style="padding-right:0.5rem;">•</span> Lab 8</a></li>
              <li class="pure-menu-item "><a href="/DataScienceTutorials.jl/isl/lab-9/" class="pure-menu-link"><span
                    style="padding-right:0.5rem;">•</span> Lab 9</a></li>
              <li class="pure-menu-item "><a href="/DataScienceTutorials.jl/isl/lab-10/" class="pure-menu-link"><span
                    style="padding-right:0.5rem;">•</span> Lab 10</a></li>
            </ul>
          </div>
          <!-- End to End -->
          <div class="dropdown">
            <li class="pure-menu-sublist-title"><strong>End to End</strong></li>
          </div>
          <div class="dropdown-content collapse">
            <ul class="pure-menu-sublist" >
              <li class="pure-menu-item "><a
                  href="/DataScienceTutorials.jl/end-to-end/telco/" class="pure-menu-link"><span style="padding-right:0.5rem;">•</span>Telco
                  Churn</a></li>
              <li class="pure-menu-item "><a
                  href="/DataScienceTutorials.jl/end-to-end/AMES/" class="pure-menu-link"><span style="padding-right:0.5rem;">•</span> AMES</a>
              </li>
              <li class="pure-menu-item "><a href="/DataScienceTutorials.jl/end-to-end/wine/" class="pure-menu-link"><span
                    style="padding-right:0.5rem;">•</span> Wine</a></li>
              <li class="pure-menu-item "><a
                  href="/DataScienceTutorials.jl/end-to-end/crabs-xgb/" class="pure-menu-link"><span style="padding-right:0.5rem;">•</span>
                  Crabs (XGB)</a></li>
              <li class="pure-menu-item "><a href="/DataScienceTutorials.jl/end-to-end/horse/" class="pure-menu-link"><span
                    style="padding-right:0.5rem;">•</span> Horse</a></li>
              <li class="pure-menu-item "><a href="/DataScienceTutorials.jl/end-to-end/HouseKingCounty/" class="pure-menu-link"><span
                    style="padding-right:0.5rem;">•</span> King County Houses</a></li>
              <li class="pure-menu-item "><a href="/DataScienceTutorials.jl/end-to-end/airfoil" class="pure-menu-link"><span
                    style="padding-right:0.5rem;">•</span> Airfoil </a></li>
              <li class="pure-menu-item "><a href="/DataScienceTutorials.jl/end-to-end/boston-lgbm" class="pure-menu-link"><span
                    style="padding-right:0.5rem;">•</span> Boston (lgbm) </a></li>
              <li class="pure-menu-item "><a href="/DataScienceTutorials.jl/end-to-end/glm/" class="pure-menu-link"><span
                    style="padding-right:0.5rem;">•</span> Using GLM.jl </a></li>
              <li class="pure-menu-item "><a href="/DataScienceTutorials.jl/end-to-end/powergen/" class="pure-menu-link"><span
                    style="padding-right:0.5rem;">•</span> Power Generation </a></li>
              <li class="pure-menu-item "><a href="/DataScienceTutorials.jl/end-to-end/boston-flux" class="pure-menu-link"><span
                    style="padding-right:0.5rem;">•</span> Boston (Flux) </a></li>
              <li class="pure-menu-item "><a href="/DataScienceTutorials.jl/end-to-end/breastcancer" class="pure-menu-link"><span
                    style="padding-right:0.5rem;">•</span> Breast Cancer</a></li>
              <li class="pure-menu-item "><a href="/DataScienceTutorials.jl/end-to-end/creditfraud" class="pure-menu-link"><span
                    style="padding-right:0.5rem;">•</span> Credit Fraud</a></li>
            </ul>
          </div>
          <!-- ADVANCED EXAMPLES -->
          <div class="dropdown">
            <li class="pure-menu-sublist-title"><strong>Advanced Examples</strong></li>
          </div>
          <div class="dropdown-content collapse">
            <ul class="pure-menu-sublist" id=adv>
              <li class="pure-menu-item "><a href="/DataScienceTutorials.jl/advanced/ensembles-3/" class="pure-menu-link"><span
                    style="padding-right:0.5rem;">•</span> Ensembles (3)</a></li>
            </ul>
          </div>
      </div>
      </ul>
      <!-- END OF LIST OF MENU ITEMS -->
    </div>
  </div>
  <div id="nav" class="navigation">
    <div class="nav-container">
      <div class="brand">
        <a href="/DataScienceTutorials.jl/">DataScienceTutorials.jl</a>
      </div>
      <nav>
        <div class="nav-mobile"><a id="nav-toggle" href="#!"><span></span></a></div>
        <ul class="nav-list">
        <!-- horizontal navigation bar gets injected -->
        </ul>
      </nav>
    </div>
  </div>
  <div id="main"> <!-- Closed in foot -->
    

    <!-- Content appended here --><div class="franklin-content"><h1 id="further_data_processing"><a href="#further_data_processing" class="header-anchor">Further data processing</a></h1>
<em>To ensure code in this tutorial runs as shown, download the tutorial <a href="https://raw.githubusercontent.com/juliaai/DataScienceTutorials.jl/gh-pages/__generated/data/processing.tar.gz">project folder</a> and follow <a href="/DataScienceTutorials.jl/#learning_by_doing">these instructions</a>.</em></p>
<p><em>If you have questions or suggestions about this tutorial, please open an issue <a href="https://github.com/JuliaAI/DataScienceTutorials.jl/issues/new">here</a>.</em></p>
<p><div class="franklin-toc"><ol><li><a href="#more_data_processing">More data processing</a></li></ol></div>
<div class="dropdown"><h2 id="more_data_processing"><a href="#more_data_processing" class="header-anchor">More data processing</a></h2></div>
<div class="dropdown-content"><p>This tutorial uses the World Resources Institute Global Power Plants Dataset to explore data pre-processing in Julia. The dataset is created from multiple sources and is under continuous update, which means that there are lots of missing data, non-standard characters, etc Hence plenty of material to work with&#33;</p>
<p>More tutorials on the manipulation of DataFrames can be found <a href="https://github.com/bkamins/Julia-DataFrames-Tutorial">here</a> And some more information can be found on <a href="https://en.wikibooks.org/wiki/Introducing_Julia/DataFrames">this</a> wikipage.</p>
<pre><code class="language-julia">import MLJ: schema, std, mean, median, coerce, coerce&#33;, scitype
using DataFrames
using UrlDownload</code></pre>
<p>Import data</p>
<pre><code class="language-julia">raw_data &#61; urldownload&#40;&quot;https://github.com/tlienart/DataScienceTutorialsData.jl/blob/master/data/wri_global_power_plant_db_be_022020.csv?raw&#61;true&quot;&#41;
data &#61; DataFrame&#40;raw_data&#41;;</code></pre>
<p>This dataset contains information on power generation plants for a number of countries around the world. The level of disaggregation is the power plant. For each plant, there is information about its name, localisation, capacity, and many other features. The schema function enables us to get a quick overview of the variables it contains, including their machine and scentific types.</p>
<pre><code class="language-julia">schema&#40;data&#41;</code></pre><pre><code class="plaintext code-output">┌──────────────────────────┬────────────────────────────┬──────────────────────────┐
│ names                    │ scitypes                   │ types                    │
├──────────────────────────┼────────────────────────────┼──────────────────────────┤
│ country                  │ Textual                    │ String3                  │
│ country_long             │ Textual                    │ String                   │
│ name                     │ Textual                    │ String                   │
│ gppd_idnr                │ Textual                    │ String15                 │
│ capacity_mw              │ Continuous                 │ Float64                  │
│ latitude                 │ Continuous                 │ Float64                  │
│ longitude                │ Continuous                 │ Float64                  │
│ primary_fuel             │ Textual                    │ String15                 │
│ other_fuel1              │ Union{Missing, Textual}    │ Union{Missing, String15} │
│ other_fuel2              │ Union{Missing, Textual}    │ Union{Missing, String7}  │
│ other_fuel3              │ Union{Missing, Textual}    │ Union{Missing, String7}  │
│ commissioning_year       │ Union{Missing, Continuous} │ Union{Missing, Float64}  │
│ owner                    │ Union{Missing, Textual}    │ Union{Missing, String}   │
│ source                   │ Union{Missing, Textual}    │ Union{Missing, String}   │
│ url                      │ Union{Missing, Textual}    │ Union{Missing, String}   │
│ geolocation_source       │ Union{Missing, Textual}    │ Union{Missing, String}   │
│ wepp_id                  │ Union{Missing, Textual}    │ Union{Missing, String31} │
│ year_of_capacity_data    │ Union{Missing, Count}      │ Union{Missing, Int64}    │
│ generation_gwh_2013      │ Union{Missing, Continuous} │ Union{Missing, Float64}  │
│ generation_gwh_2014      │ Union{Missing, Continuous} │ Union{Missing, Float64}  │
│ generation_gwh_2015      │ Union{Missing, Continuous} │ Union{Missing, Float64}  │
│ generation_gwh_2016      │ Union{Missing, Continuous} │ Union{Missing, Float64}  │
│ generation_gwh_2017      │ Union{Missing, Continuous} │ Union{Missing, Float64}  │
│ generation_data_source   │ Union{Missing, Textual}    │ Union{Missing, String}   │
│ estimated_generation_gwh │ Union{Missing, Continuous} │ Union{Missing, Float64}  │
└──────────────────────────┴────────────────────────────┴──────────────────────────┘
</code></pre>
<p>We see that a small number of features have values for all plants &#40;i.e. for each row&#41; present in the dataset. However, &#40;i&#41; several features have missing values &#40;Union&#123;Missing, _.type&#125;&#41; and &#40;ii&#41; we are not interested in working with all of these features. In particular, we&#39;re not intersted in the source of the information present in the dataset nor are we interested in the generation data. Hence we drop all columns which contain information&#39;s source. We define a function <code>is_active&#40;&#41;</code> that will return a <code>TRUE</code> boolean value if the column name does NOT &#40;<code>&#33;</code>&#41; contain either of the strings &quot;source&quot; or &quot;generation&quot;. Note the conversion of column names from <code>:Symbol</code> to <code>:string</code> since the <code>occursing</code> function only accepts strings as arguments.</p>
<pre><code class="language-julia">is_active&#40;col&#41; &#61; &#33;occursin&#40;r&quot;source|generation&quot;, string&#40;col&#41;&#41;
active_cols &#61; &#91;col for col in names&#40;data&#41; if is_active&#40;col&#41;&#93;
select&#33;&#40;data, active_cols&#41;;</code></pre>
<p>We also drop a number of other unwanted columns and take a look at our &quot;new&quot; dataframe.</p>
<pre><code class="language-julia">select&#33;&#40;data, Not&#40;&#91;:wepp_id, :url, :owner&#93;&#41;&#41;
schema&#40;data&#41;</code></pre><pre><code class="plaintext code-output">┌───────────────────────┬────────────────────────────┬──────────────────────────┐
│ names                 │ scitypes                   │ types                    │
├───────────────────────┼────────────────────────────┼──────────────────────────┤
│ country               │ Textual                    │ String3                  │
│ country_long          │ Textual                    │ String                   │
│ name                  │ Textual                    │ String                   │
│ gppd_idnr             │ Textual                    │ String15                 │
│ capacity_mw           │ Continuous                 │ Float64                  │
│ latitude              │ Continuous                 │ Float64                  │
│ longitude             │ Continuous                 │ Float64                  │
│ primary_fuel          │ Textual                    │ String15                 │
│ other_fuel1           │ Union{Missing, Textual}    │ Union{Missing, String15} │
│ other_fuel2           │ Union{Missing, Textual}    │ Union{Missing, String7}  │
│ other_fuel3           │ Union{Missing, Textual}    │ Union{Missing, String7}  │
│ commissioning_year    │ Union{Missing, Continuous} │ Union{Missing, Float64}  │
│ year_of_capacity_data │ Union{Missing, Count}      │ Union{Missing, Int64}    │
└───────────────────────┴────────────────────────────┴──────────────────────────┘
</code></pre>
<p>The remaining variables have two different scientific types: Continuous, Textual Of which we can get an overview.</p>
<pre><code class="language-julia">describe&#40;data&#41;

# The describe&#40;&#41; function shows that there are several features with missing values.</code></pre><pre><code class="plaintext code-output">13×7 DataFrame
 Row │ variable               mean     min          median   max                nmissing  eltype
     │ Symbol                 Union…   Any          Union…   Any                Int64     Type
─────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────
   1 │ country                         AFG                   ZWE                       0  String3
   2 │ country_long                    Afghanistan           Zimbabwe                  0  String
   3 │ name                            'Muela                \u200bVärtaverket         0  String
   4 │ gppd_idnr                       ARG0000001            WRI1075863                0  String15
   5 │ capacity_mw            168.993  1.0          18.3     22500.0                   0  Float64
   6 │ latitude               32.5014  -77.847      39.5835  71.292                    0  Float64
   7 │ longitude              -4.1955  -179.978     -1.2744  179.389                   0  Float64
   8 │ primary_fuel                    Biomass               Wind                      0  String15
   9 │ other_fuel1                     Biomass               Wind                  31680  Union{Missing, String15}
  10 │ other_fuel2                     Biomass               Wind                  33340  Union{Missing, String7}
  11 │ other_fuel3                     Biomass               Wind                  33539  Union{Missing, String7}
  12 │ commissioning_year     1995.49  1896.0       2005.0   2018.0                17340  Union{Missing, Float64}
  13 │ year_of_capacity_data  2016.86  2000         2017.0   2018                  19900  Union{Missing, Int64}</code></pre>
<p><em>Note:</em> the <code>describe&#40;&#41;</code> function is from the <code>DataFrames</code> package &#40;and won&#39;t work with other, non DataFrames, tables&#41; whereas the <code>schema&#40;&#41;</code> is from the MLJ package.</p>
<p>Let&#39;s play around with capacity data, for which there are no missing values. We create a sub-dataframe and aggregate over certain dimensions &#40;country and primary_fuel&#41;</p>
<pre><code class="language-julia">capacity &#61; select&#40;data, &#91;:country, :primary_fuel, :capacity_mw&#93;&#41;;
first&#40;capacity, 5&#41;</code></pre><pre><code class="plaintext code-output">5×3 DataFrame
 Row │ country  primary_fuel  capacity_mw
     │ String3  String15      Float64
─────┼────────────────────────────────────
   1 │ AFG      Hydro                33.0
   2 │ AFG      Solar                10.0
   3 │ AFG      Solar                10.0
   4 │ AFG      Hydro                66.0
   5 │ AFG      Hydro               100.0</code></pre>
<p>This dataframe contains several subgroups &#40;country and technology type&#41; and it would be interesting to get data aggregates by subgroup. To obtain a <code>view</code> of the DataFrame by subgroup, we can use the <code>groupby</code> function. &#40;See the <a href="https://alan-turing-institute.github.io/DataScienceTutorials.jl/data/dataframe/#groupby">DataFrame tutorial</a> for an introduction to the use of <code>groupby</code>&#41;</p>
<pre><code class="language-julia">cap_gr &#61; groupby&#40;capacity, &#91;:country, :primary_fuel&#93;&#41;;</code></pre>
<p>If we want to aggregate at the country-fuel-type level and calculate summary statistics at this level, we can use the <code>combine</code> function on the GroupedDataFrame that we just created. This function takes the GroupedDataFrame, the symbol of the column on which to apply the measure of choice as arguments.</p>
<pre><code class="language-julia">cap_mean &#61; combine&#40;cap_gr, :capacity_mw &#61;&gt; mean&#41;
cap_sum &#61; combine&#40;cap_gr, :capacity_mw &#61;&gt; sum&#41;
first&#40;cap_sum, 3&#41;</code></pre><pre><code class="plaintext code-output">3×3 DataFrame
 Row │ country  primary_fuel  capacity_mw_sum
     │ String3  String15      Float64
─────┼────────────────────────────────────────
   1 │ AFG      Hydro                  238.55
   2 │ AFG      Solar                   20.0
   3 │ AFG      Gas                     42.0</code></pre>
<p>Now let&#39;s plot some of this aggregate data for a selection of countries, by country and technology type</p>
<pre><code class="language-julia">ctry_selec &#61; r&quot;BEL|FRA|DEU&quot;
tech_selec &#61; r&quot;Solar&quot;

cap_sum_plot &#61; cap_sum&#91;occursin.&#40;ctry_selec, cap_sum.country&#41; .&amp; occursin.&#40;tech_selec, cap_sum.primary_fuel&#41;, :&#93;</code></pre><pre><code class="plaintext code-output">3×3 DataFrame
 Row │ country  primary_fuel  capacity_mw_sum
     │ String3  String15      Float64
─────┼────────────────────────────────────────
   1 │ BEL      Solar                  116.2
   2 │ FRA      Solar                 4910.42
   3 │ DEU      Solar                 6770.56</code></pre>
<p>Note the <code>.</code> for element-wise comparison Before plotting, we can also sort values by decreasing order using <code>sort&#33;&#40;&#41;</code>.</p>
<pre><code class="language-julia">sort&#33;&#40;cap_sum_plot, :capacity_mw_sum, rev&#61;true&#41;

using Plots

Plots.bar&#40;cap_sum_plot.country, cap_sum_plot.capacity_mw_sum, legend&#61;false&#41;</code></pre>
<img src="/DataScienceTutorials.jl/assets/data/processing/code/output/D0-processing-g1.svg" alt="processing1">
<p>Now that we have the total capacity by country and technology type, let&#39;s use it to calculate the share of each technology in total capacity. To that end we first create a dataframe containing the country-level total capacity, using the same steps as above.</p>
<pre><code class="language-julia">cap_sum_ctry_gd &#61; groupby&#40;capacity, &#91;:country&#93;&#41;;
cap_sum_ctry &#61; combine&#40;cap_sum_ctry_gd, :capacity_mw &#61;&gt; sum&#41;;</code></pre>
<p>The we join this dataframe with the disaggregated one; which requires that we convert the two GroupedDataFrame into DataFrames.</p>
<pre><code class="language-julia">cap_sum &#61; DataFrame&#40;cap_sum&#41;;
cap_sum_ctry &#61; DataFrame&#40;cap_sum_ctry&#41;;
cap_share &#61; leftjoin&#40;cap_sum, cap_sum_ctry, on &#61; :country, makeunique &#61; true&#41;
cap_share.capacity_mw_share &#61; cap_share.capacity_mw_sum ./ cap_share.capacity_mw_sum_1;</code></pre>
<p>Let&#39;s visualise our dataframe again, which now includes the <code>capacity_mw_share</code> column.</p>
<p>Now let&#39;s analyse features which exhibit some missing values. Suppose we want to calculate the age of each plant &#40;rounded to full years&#41;. We face two issues. First, the commissioning_year is not reported for all plants. We need to gauge the representativity of the plants for which it is available with regard to the full dataset. One way to count the missing values is</p>
<pre><code class="language-julia">nMissings &#61; length&#40;findall&#40;x -&gt; ismissing&#40;x&#41;, data.commissioning_year&#41;&#41;</code></pre><pre><code class="plaintext code-output">17340</code></pre>
<p>This represents about half of our observations</p>
<pre><code class="language-julia">nMissings_share &#61; nMissings/size&#40;data&#41;&#91;1&#93;</code></pre><pre><code class="plaintext code-output">0.515411824153613</code></pre>
<p>Second, the commissioning year is not reported as an integer. Fractions of years are reported too. As a result, the machine type of <code>data.commissioning_year</code>is Float64.</p>
<pre><code class="language-julia">typeof&#40;data.commissioning_year&#41;</code></pre><pre><code class="plaintext code-output">Vector{Union{Missing, Float64}} (alias for Array{Union{Missing, Float64}, 1})</code></pre>
<p>Before calculating the average age, let&#39;s drop the missing values.</p>
<pre><code class="language-julia">data_nmiss &#61; dropmissing&#40;data, :commissioning_year&#41;;</code></pre>
<p>And round the year to the closest integer. We can do this using the <code>round</code> function and a mapping function on the relevant DataFrame column.</p>
<pre><code class="language-julia">map&#33;&#40;x -&gt; round&#40;x, digits&#61;0&#41;, data_nmiss.commissioning_year, data_nmiss.commissioning_year&#41;;

# We can now calculate plant age for each plant &#40;worth remembering that the dataset only contains active plants&#41;

current_year &#61; fill&#33;&#40;Array&#123;Float64&#125;&#40;undef, size&#40;data_nmiss&#41;&#91;1&#93;&#41;, 2020&#41;;
data_nmiss&#91;:, :plant_age&#93; &#61; current_year - data_nmiss&#91;:, :commissioning_year&#93;;</code></pre>
<p>Since the commissioning year is missing for about half the plants in the dataset &#40;17340, see description of data above&#41; and that missing values propagate, the plant age will only be available for 33643-17340 plants. Let&#39;s see what the mean and median plant ages are across the plants for which we have the data</p>
<pre><code class="language-julia">mean_age &#61; mean&#40;skipmissing&#40;data_nmiss.plant_age&#41;&#41;
median_age &#61; median&#40;skipmissing&#40;data_nmiss.plant_age&#41;&#41;</code></pre><pre><code class="plaintext code-output">15.0</code></pre>
<p>And bring this into a frequency plot of the plant age observations</p>
<pre><code class="language-julia">histogram&#40;data_nmiss.plant_age, color&#61;&quot;blue&quot;,  bins&#61;100, label&#61;&quot;Plant Age Frequency&quot;,
          normalize&#61;:pdf, alpha&#61;0.5, xlim&#61;&#40;0,130&#41;&#41;
vline&#33;&#40;&#91;mean_age&#93;, linewidth&#61;2, color&#61;&quot;red&quot;, label&#61;&quot;Mean Age&quot;&#41;
vline&#33;&#40;&#91;median_age&#93;, linewidth&#61;2, color&#61;&quot;orange&quot;, label&#61;&quot;Median Age&quot;&#41;</code></pre>
<img src="/DataScienceTutorials.jl/assets/data/processing/code/output/D0-processing-g2.svg" alt="processing2">
<p>We can also calculate and plot average plant age by country and technology Make sure all columns passed, other than the aggregation dimensions, are of type <code>Float</code> or <code>Int</code>, otherwise the function execution will fail.</p>
<pre><code class="language-julia">age &#61; select&#40;data_nmiss, &#91;:country, :primary_fuel, :plant_age&#93;&#41;
age_mean &#61; combine&#40;groupby&#40;age, &#91;:country, :primary_fuel&#93;&#41;, :plant_age &#61;&gt; mean&#41;

coal_means &#61; age_mean&#91;occursin.&#40;ctry_selec, age_mean.country&#41; .&amp; occursin.&#40;r&quot;Coal&quot;, age_mean.primary_fuel&#41;, :&#93;
gas_means &#61; age_mean&#91;occursin.&#40;ctry_selec, age_mean.country&#41; .&amp; occursin.&#40;r&quot;Gas&quot;, age_mean.primary_fuel&#41;, :&#93;</code></pre><pre><code class="plaintext code-output">2×3 DataFrame
 Row │ country  primary_fuel  plant_age_mean
     │ String3  String15      Float64
─────┼───────────────────────────────────────
   1 │ BEL      Gas                  16.5
   2 │ DEU      Gas                  25.6867</code></pre>
<p>fig.suptitle&#40;&quot;Mean plant age by country and technology&quot;&#41;</p>
<pre><code class="language-julia">p1 &#61; Plots.bar&#40;coal_means.country, coal_means.plant_age_mean, ylabel&#61;&quot;Age&quot;, title&#61;&quot;Coal&quot;&#41;
p2 &#61; Plots.bar&#40;gas_means.country, gas_means.plant_age_mean, title&#61;&quot;Gas&quot;&#41;

plot&#40;p1, p2, layout&#61;&#40;1, 2&#41;, size&#61;&#40;900,600&#41;, plot_title&#61;&quot;Mean plant age by country and technology&quot;&#41;</code></pre>
<img src="/DataScienceTutorials.jl/assets/data/processing/code/output/D0-processing-g3.svg" alt="processing3">
<p>‎</p></div>

<div class="bottom-nav-container">
  <a id="prev-tutorial" style="text-decoration: none"><Button class="bottom-nav">
        <div>← Previous Tutorial</div>
        <div id="prev-label" class="button-label"> Home</div>
    </Button></a>
  <a id="next-tutorial" style="text-decoration: none"><Button class="bottom-nav">
        <div>Next Tutorial →</div>
        <div id="next-label" class="button-label">Home</div> 
    </Button></a>
</div>
<div class="page-foot">
  <div class="copyright">
    &copy; Thibaut Lienart, Anthony Blaom, Sebastian Vollmer and collaborators. Last modified: April 15, 2024. Website built with <a
      href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a>.
  </div>
</div></div><!-- CONTENT ENDS HERE -->
</div> <!-- end of id=main -->
</div> <!-- end of id=layout -->
<!-- for collapse functionality -->
<script src="/DataScienceTutorials.jl/libs/collapse/collapse.js"></script>
<script src="/DataScienceTutorials.jl/libs/pure/ui.min.js"></script>
<!-- head and footer-nav -->
<script src="/DataScienceTutorials.jl/libs/nav/head.js"  type="module"></script>
<!-- landing page -->
<script src="/DataScienceTutorials.jl/libs/landing/landing.js"></script>
<!-- navigation bar -->
<script src="/DataScienceTutorials.jl/libs/nav/nav.js"></script>
<!-- responsive navigation bar -->
<script src="/DataScienceTutorials.jl/libs/nav/responsive.js"></script>


<script src="/DataScienceTutorials.jl/libs/highlight/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();hljs.configure({tabReplace: '    '});</script>


</body>

</html>