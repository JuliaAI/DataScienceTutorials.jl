<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/MLJTutorials/libs/highlight/github.min.css"> <link rel=stylesheet  href="/MLJTutorials/css/judoc.css"> <link rel=stylesheet  href="/MLJTutorials/css/pure.css"> <link rel=stylesheet  href="/MLJTutorials/css/side-menu.css"> <link rel=stylesheet  href="/MLJTutorials/css/extra.css"> <title></title> <div id=layout > <a href="#menu" id=menuLink  class=menu-link ><span></span></a> <div id=menu > <div class=pure-menu > <a href="/MLJTutorials/" id=menu-logo-link > <div class=menu-logo > <img id=menu-logo  alt="MLJ Logo" src="/MLJTutorials/assets/infra/MLJLogo2.svg" /> <p><strong>MLJ Tutorials</strong></p> </div> </a> <ul class=pure-menu-list > <li class="pure-menu-item pure-menu-top-item "><a href="/MLJTutorials/" class=pure-menu-link ><strong>Home</strong></a> <li class=pure-menu-sublist-title ><strong>Getting started</strong> <ul class=pure-menu-sublist > <li class="pure-menu-item "><a href="/MLJTutorials/pub/getting-started/choosing-a-model.html" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Choosing a model</a> <li class="pure-menu-item "><a href="/MLJTutorials/pub/getting-started/fit-and-predict.html" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Fit, predict, transform</a> <li class="pure-menu-item "><a href="/MLJTutorials/pub/getting-started/model-tuning.html" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Model tuning</a> <li class="pure-menu-item "><a href="/MLJTutorials/pub/getting-started/ensembles.html" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Ensembles</a> <li class="pure-menu-item "><a href="/MLJTutorials/pub/getting-started/ensembles-2.html" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Ensembles (2)</a> <li class="pure-menu-item "><a href="/MLJTutorials/pub/getting-started/composing-models.html" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Composing models</a> <li class="pure-menu-item "><a href="/MLJTutorials/pub/getting-started/learning-networks.html" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Learning networks</a> <li class="pure-menu-item "><a href="/MLJTutorials/pub/getting-started/learning-networks-2.html" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Learning networks (2)</a> </ul> <li class=pure-menu-sublist-title ><strong>End to end examples</strong> <ul class=pure-menu-sublist  id=e2e> <li class="pure-menu-item "><a href="/MLJTutorials/pub/end-to-end/AMES.html" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> AMES</a> <li class="pure-menu-item "><a href="/MLJTutorials/pub/end-to-end/wine.html" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Wine</a> <li class="pure-menu-item "><a href="/MLJTutorials/pub/end-to-end/crabs-xgb.html" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Crabs (XGB)</a> <li class="pure-menu-item "><a href="/MLJTutorials/pub/end-to-end/horse.html" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Horse</a> </ul> <li class=pure-menu-sublist-title ><strong>Intro to Stats Learning</strong> <ul class=pure-menu-sublist  id=isl> <li class="pure-menu-item "><a href="/MLJTutorials/pub/isl/lab-2.html" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Lab 2</a> <li class="pure-menu-item "><a href="/MLJTutorials/pub/isl/lab-3.html" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Lab 3</a> <li class="pure-menu-item "><a href="/MLJTutorials/pub/isl/lab-4.html" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Lab 4</a> </ul> </ul> </div> </div> <div id=main > <div class=jd-content > <h1 id=lab_4_-_logistic_regression_lda_qda_knn ><a href="/MLJTutorials/pub/isl/lab-4.html#lab_4_-_logistic_regression_lda_qda_knn">Lab 4 - Logistic Regression, LDA, QDA, KNN</a></h1> <em>Download the</em> <a href="https://raw.githubusercontent.com/alan-turing-institute/MLJTutorials/gh-pages/notebooks/ISL-lab-4.ipynb" target=_blank ><em>notebook</em></a> <em>or the</em> <a href="https://raw.githubusercontent.com/alan-turing-institute/MLJTutorials/gh-pages/scripts/ISL-lab-4.jl" target=_blank ><em>raw script</em></a> <em>for this tutorial &#40;right-click on the link and save&#41;.</em> <div class=jd-toc ><ol><li><a href="/MLJTutorials/pub/isl/lab-4.html#stock_market_data">Stock market data</a><ol><li><a href="/MLJTutorials/pub/isl/lab-4.html#logistic_regression">Logistic Regression</a><li><a href="/MLJTutorials/pub/isl/lab-4.html#lda">LDA</a><li><a href="/MLJTutorials/pub/isl/lab-4.html#qda">QDA</a><li><a href="/MLJTutorials/pub/isl/lab-4.html#knn">KNN</a></ol><li><a href="/MLJTutorials/pub/isl/lab-4.html#caravan_insurance_data">Caravan insurance data</a></ol></div><h2 id=stock_market_data ><a href="/MLJTutorials/pub/isl/lab-4.html#stock_market_data">Stock market data</a></h2> <p>Let&#39;s load the usual packages and the data</p> <pre><code class="julia hljs"><span class=hljs-keyword >using</span> MLJ, RDatasets, ScientificTypes,
      DataFrames, Statistics, StatsBase

smarket = dataset(<span class=hljs-string >"ISLR"</span>, <span class=hljs-string >"Smarket"</span>)
<span class=hljs-meta >@show</span> size(smarket)
<span class=hljs-meta >@show</span> names(smarket)</code></pre><div class=code_output ><pre><code class="plaintext hljs">size(smarket) = (1250, 9)
names(smarket) = [:Year, :Lag1, :Lag2, :Lag3, :Lag4, :Lag5, :Volume, :Today, :Direction]
</code></pre></div> <p>Let&#39;s get a description too</p> <pre><code class="julia hljs">describe(smarket, :mean, :std, :eltype)</code></pre><div class=code_output ><pre><code class="plaintext hljs">9×4 DataFrame
│ Row │ variable  │ mean      │ std      │ eltype                   │
│     │ Symbol    │ Union…    │ Union…   │ DataType                 │
├─────┼───────────┼───────────┼──────────┼──────────────────────────┤
│ 1   │ Year      │ 2003.02   │ 1.40902  │ Float64                  │
│ 2   │ Lag1      │ 0.0038344 │ 1.1363   │ Float64                  │
│ 3   │ Lag2      │ 0.0039192 │ 1.13628  │ Float64                  │
│ 4   │ Lag3      │ 0.001716  │ 1.1387   │ Float64                  │
│ 5   │ Lag4      │ 0.001636  │ 1.13877  │ Float64                  │
│ 6   │ Lag5      │ 0.0056096 │ 1.14755  │ Float64                  │
│ 7   │ Volume    │ 1.4783    │ 0.360357 │ Float64                  │
│ 8   │ Today     │ 0.0031384 │ 1.13633  │ Float64                  │
│ 9   │ Direction │           │          │ CategoricalString{UInt8} │</code></pre></div> <p>The target variable is <code>:Direction</code>:</p> <pre><code class="julia hljs">y = smarket.Direction
X = select(smarket, Not(:Direction));</code></pre> <p>We can compute all the pairwise correlations; we use <code>Matrix</code> so that the dataframe entries are considered as one matrix of numbers &#40;otherwise <code>cor</code> won&#39;t work&#41;:</p> <pre><code class="julia hljs">cm = X |&gt; <span class=hljs-built_in >Matrix</span> |&gt; cor
round.(cm, sigdigits=<span class=hljs-number >1</span>)</code></pre><div class=code_output ><pre><code class="plaintext hljs">8×8 Array{Float64,2}:
 1.0    0.03    0.03    0.03    0.04    0.03    0.5    0.03
 0.03   1.0    -0.03   -0.01   -0.003  -0.006   0.04  -0.03
 0.03  -0.03    1.0    -0.03   -0.01   -0.004  -0.04  -0.01
 0.03  -0.01   -0.03    1.0    -0.02   -0.02   -0.04  -0.002
 0.04  -0.003  -0.01   -0.02    1.0    -0.03   -0.05  -0.007
 0.03  -0.006  -0.004  -0.02   -0.03    1.0    -0.02  -0.03
 0.5    0.04   -0.04   -0.04   -0.05   -0.02    1.0    0.01
 0.03  -0.03   -0.01   -0.002  -0.007  -0.03    0.01   1.0</code></pre></div> <p>Let&#39;s see what the <code>:Volume</code> feature looks like:</p> <pre><code class="julia hljs"><span class=hljs-keyword >using</span> PyPlot
figure(figsize=(<span class=hljs-number >8</span>,<span class=hljs-number >6</span>))
plot(X.Volume)
xlabel(<span class=hljs-string >"Tick number"</span>, fontsize=<span class=hljs-number >14</span>)
ylabel(<span class=hljs-string >"Volume"</span>, fontsize=<span class=hljs-number >14</span>)
xticks(fontsize=<span class=hljs-number >12</span>)
yticks(fontsize=<span class=hljs-number >12</span>)
</code></pre> <p><img src="/MLJTutorials/assets/ISL-volume.svg" alt=volume  /></p> <h3 id=logistic_regression ><a href="/MLJTutorials/pub/isl/lab-4.html#logistic_regression">Logistic Regression</a></h3> <p>We will now try to train models; the target <code>:Direction</code> has two classes: <code>Up</code> and <code>Down</code>; it needs to be interpreted as a Multiclass object first:</p> <pre><code class="julia hljs">yc = coerce(y, Multiclass)
unique(yc)</code></pre><div class=code_output ><pre><code class="plaintext hljs">2-element Array{String,1}:
 "Up"
 "Down"</code></pre></div> <p>Let&#39;s now try fitting a simple logistic classifier &#40;aka logistic regression&#41; not using <code>:Year</code> and <code>:Today</code>:</p> <pre><code class="julia hljs"><span class=hljs-meta >@load</span> LogisticClassifier pkg=MLJLinearModels
X2 = select(X, Not([:Year, :Today]))
clf = machine(LogisticClassifier(), X2, y)</code></pre><div class=code_output ><pre><code class="plaintext hljs">Machine{LogisticClassifier} @ 1…80
</code></pre></div> <p>Let&#39;s fit it to the data and try to reproduce the output:</p> <pre><code class="julia hljs">fit!(clf)
ŷ = predict(clf, X2)
cross_entropy(ŷ, y) |&gt; mean</code></pre><div class=code_output ><pre><code class="plaintext hljs">0.6910338223694449</code></pre></div>
<p>Note that here the <code>ŷ</code> are <em>scores</em>; in order to recover the class, we could use the mode and compare the misclassification rate:</p>
<pre><code class="julia hljs">ŷ = predict_mode(clf, X2)
misclassification_rate(ŷ, y)</code></pre><div class=code_output ><pre><code class="plaintext hljs">0.4792</code></pre></div>
<p>Well that&#39;s not fantastic...</p>
<p>Let&#39;s visualise how we&#39;re doing building a confusion matrix manually, first is predicted, second is truth:</p>
<pre><code class="julia hljs">TN = down_down = sum(ŷ .== y .== <span class=hljs-string >"Down"</span>)
FN = down_up = sum(ŷ .!= y .== <span class=hljs-string >"Up"</span>)
FP = up_down = sum(ŷ .!= y .== <span class=hljs-string >"Down"</span>)
TP = up_up = sum(ŷ .== y .== <span class=hljs-string >"Up"</span>)

conf_mat = [down_down down_up; up_down up_up]</code></pre><div class=code_output ><pre><code class="plaintext hljs">2×2 Array{Int64,2}:
 144  141
 458  507</code></pre></div>
<p>We can then compute the accuracy or precision easily for instance:</p>
<pre><code class="julia hljs">acc = (TN + TP) / length(y)
prec = TP /  (TP + FP)
rec  = TP / (TP + FN)
<span class=hljs-meta >@show</span> round(acc, sigdigits=<span class=hljs-number >3</span>)
<span class=hljs-meta >@show</span> round(prec, sigdigits=<span class=hljs-number >3</span>)
<span class=hljs-meta >@show</span> round(rec, sigdigits=<span class=hljs-number >3</span>)</code></pre><div class=code_output ><pre><code class="plaintext hljs">round(acc, sigdigits=3) = 0.521
round(prec, sigdigits=3) = 0.525
round(rec, sigdigits=3) = 0.782
</code></pre></div>
<p>Let&#39;s now train on the data before 2005 and use it to predict on the rest.</p>
<h3 id=lda ><a href="/MLJTutorials/pub/isl/lab-4.html#lda">LDA</a></h3>
<h3 id=qda ><a href="/MLJTutorials/pub/isl/lab-4.html#qda">QDA</a></h3>
<p><em>QDA is not yet supported</em></p>
<h3 id=knn ><a href="/MLJTutorials/pub/isl/lab-4.html#knn">KNN</a></h3>
<h2 id=caravan_insurance_data ><a href="/MLJTutorials/pub/isl/lab-4.html#caravan_insurance_data">Caravan insurance data</a></h2>
<div class=page-foot >
  <div class=copyright >
    &copy; Anthony Blaom, Thibaut Lienart and collaborators. Last modified: October 31, 2019. Website built with <a href="https://github.com/tlienart/JuDoc.jl">JuDoc.jl</a>.
  </div>
</div>

</div>

      </div> 
  </div> 
  <script src="/MLJTutorials/libs/pure/ui.min.js"></script>