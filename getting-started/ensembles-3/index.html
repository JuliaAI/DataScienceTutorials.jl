<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/MLJTutorials/libs/highlight/github.min.css"> <link rel=stylesheet  href="/MLJTutorials/css/franklin.css"> <link rel=stylesheet  href="/MLJTutorials/css/pure.css"> <link rel=stylesheet  href="/MLJTutorials/css/side-menu.css"> <link rel=stylesheet  href="/MLJTutorials/css/extra.css"> <title>Ensemble models - extended tutorial</title> <script src="/MLJTutorials/libs/lunr/lunr.min.js"></script> <script src="/MLJTutorials/libs/lunr/lunr_index.js"></script> <script src="/MLJTutorials/libs/lunr/lunrclient.min.js"></script> <div id=layout > <a href="#menu" id=menuLink  class=menu-link ><span></span></a> <div id=menu > <div class=pure-menu > <a href="/MLJTutorials/" id=menu-logo-link > <div class=menu-logo > <img id=menu-logo  alt="MLJ Logo" src="/MLJTutorials/assets/infra/MLJLogo2.svg" /> <p><strong>MLJ Tutorials</strong></p> </div> </a> <form id=lunrSearchForm  name=lunrSearchForm > <input class=search-input  name=q  placeholder="Enter search term" type=text > <input type=submit  value=Search  formaction="/MLJTutorials/search/index.html" style="visibility:hidden"> </form> <ul class=pure-menu-list > <li class="pure-menu-item pure-menu-top-item "><a href="/MLJTutorials/" class=pure-menu-link ><strong>Home</strong></a> <li class=pure-menu-sublist-title ><strong>Data basics</strong> <ul class=pure-menu-sublist > <li class="pure-menu-item "><a href="/MLJTutorials/data/loading/" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Loading data</a> <li class="pure-menu-item "><a href="/MLJTutorials/data/dataframe/" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Data Frames</a> <li class="pure-menu-item "><a href="/MLJTutorials/data/categorical/" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Categorical Arrays</a> <li class="pure-menu-item "><a href="/MLJTutorials/data/scitype/" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Scientific Type</a> </ul> <li class=pure-menu-sublist-title ><strong>Getting started</strong> <ul class=pure-menu-sublist > <li class="pure-menu-item "><a href="/MLJTutorials/getting-started/choosing-a-model/" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Choosing a model</a> <li class="pure-menu-item "><a href="/MLJTutorials/getting-started/fit-and-predict/" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Fit, predict, transform</a> <li class="pure-menu-item "><a href="/MLJTutorials/getting-started/model-tuning/" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Model tuning</a> <li class="pure-menu-item "><a href="/MLJTutorials/getting-started/ensembles/" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Ensembles</a> <li class="pure-menu-item "><a href="/MLJTutorials/getting-started/ensembles-2/" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Ensembles (2)</a> <li class="pure-menu-item "><a href="/MLJTutorials/getting-started/ensembles-3/" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Ensembles (3)</a> <li class="pure-menu-item "><a href="/MLJTutorials/getting-started/composing-models/" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Composing models</a> <li class="pure-menu-item "><a href="/MLJTutorials/getting-started/learning-networks/" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Learning networks</a> <li class="pure-menu-item "><a href="/MLJTutorials/getting-started/learning-networks-2/" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Learning networks (2)</a> <li class="pure-menu-item "><a href="/MLJTutorials/getting-started/stacking/" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Stacking</a> </ul> <li class=pure-menu-sublist-title ><strong>Intro to Stats Learning</strong> <ul class=pure-menu-sublist  id=isl> <li class="pure-menu-item "><a href="/MLJTutorials/isl/lab-2/" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Lab 2</a> <li class="pure-menu-item "><a href="/MLJTutorials/isl/lab-3/" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Lab 3</a> <li class="pure-menu-item "><a href="/MLJTutorials/isl/lab-4/" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Lab 4</a> <li class="pure-menu-item "><a href="/MLJTutorials/isl/lab-5/" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Lab 5</a> <li class="pure-menu-item "><a href="/MLJTutorials/isl/lab-6b/" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Lab 6b</a> <li class="pure-menu-item "><a href="/MLJTutorials/isl/lab-8/" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Lab 8</a> <li class="pure-menu-item "><a href="/MLJTutorials/isl/lab-9/" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Lab 9</a> <li class="pure-menu-item "><a href="/MLJTutorials/isl/lab-10/" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Lab 10</a> </ul> <li class=pure-menu-sublist-title ><strong>End to end examples</strong> <ul class=pure-menu-sublist  id=e2e> <li class="pure-menu-item "><a href="/MLJTutorials/end-to-end/AMES/" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> AMES</a> <li class="pure-menu-item "><a href="/MLJTutorials/end-to-end/wine/" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Wine</a> <li class="pure-menu-item "><a href="/MLJTutorials/end-to-end/crabs-xgb/" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Crabs (XGB)</a> <li class="pure-menu-item "><a href="/MLJTutorials/end-to-end/horse/" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> Horse</a> <li class="pure-menu-item "><a href="/MLJTutorials/end-to-end/HouseKingCounty/" class=pure-menu-link ><span style="padding-right:0.5rem;">•</span> King County Houses</a> </ul> </ul> </div> </div> <div id=main > <div class=franklin-content > <h1 id=ensemble_models_-_extended_tutorial ><a href="#ensemble_models_-_extended_tutorial">Ensemble models - extended tutorial</a></h1> <em>Download the</em> <a href="https://raw.githubusercontent.com/alan-turing-institute/MLJTutorials/gh-pages/generated/notebooks/A-ensembles-3.ipynb" target=_blank ><em>notebook</em></a>, <em>the</em> <a href="https://raw.githubusercontent.com/alan-turing-institute/MLJTutorials/gh-pages/generated/scripts/A-ensembles-3-raw.jl" target=_blank ><em>raw script</em></a>, <em>or the</em> <a href="https://raw.githubusercontent.com/alan-turing-institute/MLJTutorials/gh-pages/generated/scripts/A-ensembles-3.jl" target=_blank ><em>annotated script</em></a> <em>for this tutorial &#40;right-click on the link and save&#41;.</em> <div class=franklin-toc ><ol><li><a href="#definition_of_composite_model_type">Definition of composite model type</a><li><a href="#application_to_data">Application to data</a></ol></div><h1 id=simple_example_of_a_homogeneous_ensemble_using_learning_networks ><a href="#simple_example_of_a_homogeneous_ensemble_using_learning_networks">Simple example of a homogeneous ensemble using learning networks</a></h1> <p>In this simple example, no bagging is used, so every atomic model gets the same learned parameters, unless the atomic model training algorithm has randomness, eg, DecisionTree with random subsampling of features at nodes.</p> <p>Note that MLJ has a built in model wrapper called <code>EnsembleModel</code> for creating bagged ensembles with a few lines of code.</p> <h2 id=definition_of_composite_model_type ><a href="#definition_of_composite_model_type">Definition of composite model type</a></h2> <pre><code class="julia hljs"><span class=hljs-keyword >using</span> MLJ, PyPlot
<span class=hljs-keyword >import</span> Statistics</code></pre> <p>learning network &#40;composite model spec&#41;:</p> <pre><code class="julia hljs">Xs = source()
ys = source(kind=:target)

atom = <span class=hljs-meta >@load</span> DecisionTreeRegressor
atom.n_subfeatures = <span class=hljs-number >4</span> <span class=hljs-comment ># to ensure diversity among trained atomic models</span>

machines = (machine(atom, Xs, ys) <span class=hljs-keyword >for</span> i <span class=hljs-keyword >in</span> <span class=hljs-number >1</span>:<span class=hljs-number >100</span>)</code></pre><pre><code class="plaintext hljs">Base.Generator{UnitRange{Int64},Main.FD_SANDBOX_15866893453267974565.var"#1#2"}(Main.FD_SANDBOX_15866893453267974565.var"#1#2"(), 1:100)</code></pre>
<p>overload <code>mean</code> for nodes:</p>
<pre><code class="julia hljs">Statistics.mean(v...) = mean(v)
Statistics.mean(v::<span class=hljs-built_in >AbstractVector</span>{&lt;:AbstractNode}) = node(mean, v...)

yhat = mean([predict(m, Xs) <span class=hljs-keyword >for</span>  m <span class=hljs-keyword >in</span> machines]);</code></pre>
<p>new composite model type and instance:</p>
<pre><code class="julia hljs">one_hundred_models = <span class=hljs-meta >@from_network</span> OneHundredModels(atom=atom) &lt;= yhat</code></pre><pre><code class="plaintext hljs">OneHundredModels(
    atom = DecisionTreeRegressor(
            max_depth = -1,
            min_samples_leaf = 5,
            min_samples_split = 2,
            min_purity_increase = 0.0,
            n_subfeatures = 4,
            post_prune = false,
            merge_purity_threshold = 1.0)) @ 1…67</code></pre>
<h2 id=application_to_data ><a href="#application_to_data">Application to data</a></h2>
<pre><code class="julia hljs">X, y = <span class=hljs-meta >@load_boston</span>;</code></pre>
<p>tune regularization parameter for a <em>single</em> tree:</p>
<pre><code class="julia hljs">r = range(atom,
          :min_samples_split,
          lower=<span class=hljs-number >2</span>,
          upper=<span class=hljs-number >100</span>, scale=:log)

mach = machine(atom, X, y)

curve = learning_curve!(mach,
                        range=r,
                        measure=mav,
                        resampling=CV(nfolds=<span class=hljs-number >9</span>),
                        verbosity=<span class=hljs-number >0</span>)

plot(curve.parameter_values, curve.measurements)
xlabel(curve.parameter_name)</code></pre>
<img src="/MLJTutorials/assets/getting-started/ensembles-3/code/output/e1.svg" alt="">
<p>tune regularization parameter for all trees in ensemble simultaneously:</p>
<pre><code class="julia hljs">r = range(one_hundred_models,
          :(atom.min_samples_split),
          lower=<span class=hljs-number >2</span>,
          upper=<span class=hljs-number >100</span>, scale=:log)

mach = machine(one_hundred_models, X, y)

curve = learning_curve!(mach,
                        range=r,
                        measure=mav,
                        resampling=CV(nfolds=<span class=hljs-number >9</span>),
                        verbosity=<span class=hljs-number >0</span>)

plot(curve.parameter_values, curve.measurements)
xlabel(curve.parameter_name)</code></pre>
<img src="/MLJTutorials/assets/getting-started/ensembles-3/code/output/e2.svg" alt="">

<div class=page-foot >
  <div class=copyright >
    &copy; Anthony Blaom, Thibaut Lienart and collaborators. Last modified: February 20, 2020. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a>.
  </div>
</div>

</div>

      </div> 
  </div> 
  <script src="/MLJTutorials/libs/pure/ui.min.js"></script>